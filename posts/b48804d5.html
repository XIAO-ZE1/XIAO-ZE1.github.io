<!DOCTYPE html><html lang="[&quot;zh-CN&quot;,&quot;en&quot;,&quot;default&quot;]" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>网站性能优化的一些小技巧 | XIAOZE</title><meta name="keywords" content="hexo,web"><meta name="author" content="xiaoze,3337484367@qq.com"><meta name="copyright" content="xiaoze"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="网站性能优化的一些小技巧"><meta name="application-name" content="网站性能优化的一些小技巧"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="网站性能优化的一些小技巧"><meta property="og:url" content="https://xiao-ze1.github.io/posts/b48804d5.html"><meta property="og:site_name" content="XIAOZE"><meta property="og:description" content="理论部分内容参考自：Web页面全链路性能优化指南，如果仅仅想进行优化不想花费太多时间了解原理可以直接跳到第二部分一、理论部分1.浏览器渲染原理我们需要知道浏览器是如何渲染一个页面的，我们才能知道如何对页面进行性能优化，所以这里我们对一些基础知识进行讲解。1.1 进程与线程浏览器有多种进程，其中最主要"><meta property="og:locale" content="[&quot;zh-CN&quot;,&quot;en&quot;,&quot;default&quot;]"><meta property="og:image" content="https://npm.elemecdn.com/ushio-api-img-moe@5.0.42/img_424_1920x1080_72_null_normal.jpg?_r_=f0c0bcf4-503c-3875-0672-a5a58d3318ef"><meta property="article:author" content="xiaoze"><meta property="article:tag" content="xiaoze,blog,life,code,markdown,hexo,butterfly,个人博客,魔改,anzhiyu"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://npm.elemecdn.com/ushio-api-img-moe@5.0.42/img_424_1920x1080_72_null_normal.jpg?_r_=f0c0bcf4-503c-3875-0672-a5a58d3318ef"><meta name="description" content="理论部分内容参考自：Web页面全链路性能优化指南，如果仅仅想进行优化不想花费太多时间了解原理可以直接跳到第二部分一、理论部分1.浏览器渲染原理我们需要知道浏览器是如何渲染一个页面的，我们才能知道如何对页面进行性能优化，所以这里我们对一些基础知识进行讲解。1.1 进程与线程浏览器有多种进程，其中最主要"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://xiao-ze1.github.io/posts/b48804d5.html"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//hm.baidu.com"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="manifest" href="/manifest.json"/><meta name="msapplication-TileColor" content="var(--theme-color)"/><link rel="mask-icon" href="/img/siteicon/128.png" color="#5bbad5"/><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/128.png"/><link rel="apple-touch-icon-precomposed" sizes="180x180" href="/img/siteicon/128.png"/><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/16.png"/><link rel="bookmark" href="/img/siteicon/128.png"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-2732.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2732-2048.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2388.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2388-1668.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1536-2048.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-1536.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2224.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2224-1668.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1620-2160.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2160-1620.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1290-2796.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2796-1290.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1179-2556.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2556-1179.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1284-2778.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2778-1284.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1170-2532.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2532-1170.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1125-2436.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2436-1125.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2688.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2688-1242.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-828-1792.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1792-828.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2208.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2208-1242.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-750-1334.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1334-750.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-640-1136.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"/><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1136-640.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?91cc5cc7ac10b434560ea0739c9d052f";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"与数百名博主无限进步","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"xiaoze","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w Don't go！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: {"enable":true,"ck":"3LD2UY1rNHXSDM5V","LingQueMonitorID":"3LD2INwvJsbGlQIl"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":4},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":5,"endTime":8},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":9,"endTime":11},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":13},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":17},{"greeting":"晚饭时间, 奖励一顿丰盛的大餐吧🍔。","startTime":18,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://twikoo-mjza-ih4k7fwdq-xiaozes-projects-7ca5bf96.vercel.app/',
  commentBarrageConfig:{"enable":true,"maxBarrage":1,"barrageTime":4000,"accessToken":"","mailMd5":"FD5E05E480CDCD6DB177B5CF21912BF8"},
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: {"apiurl":"https://fc.ruom.top/"},
  navMusic: true,
  mainTone: {"mode":"api","api":"https://img2color-go.vercel.app/api?img=","cover_change":true},
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":true,"limitCount":300,"languages":{"author":"作者: xiaoze","link":"链接: ","source":"来源: XIAOZE","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"var(--theme-color)","bgDark":"var(--theme-color)","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: {"enable":true,"delay":100,"shiftDelay":200},
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'XIAOZE',
  title: '网站性能优化的一些小技巧',
  postAI: '',
  pageFillDescription: '一、理论部分, 1.浏览器渲染原理, 1.1 进程与线程, 1.2 输入url到页面展示完整过程, 1.2.1 用户输入, 1.2.2 卸载原页面并重定向到新页面, 1.2.3 处理Service Worker, 1.2.4 网络请求, 1.2.5 服务端响应, 1.2.6 浏览器渲染详细流程, 1.3 浏览器处理每一帧的流程, 2.Chrome性能优化相关工具, 2.1 Chrome Performance(性能), 2.1.1 Chrome Performance 工具的使用, 2.1.2 使用Performance API获取性能相关指标, 2.2 Coverage(覆盖率), 2.3 Lighthouse, 2.4 Network(网络), 2.4.1 网络请求中的Timing(时间), 2.4.2 网络请求的优先级, 2.4.3 网页总资源信息, 2.4.4 Network配置, 3.网页性能优化, 3.1 网络优化策略, 3.1.1 减少HTTP请求数, 3.1.2 使用HTTP缓存, 3.1.3 使用 HTTP/2.0, 3.1.4 避免重定向, 3.1.5 使用 dns-prefetch, 3.1.6 使用域名分片, 3.1.7 CDN, 3.1.8 压缩, 3.1.9 使用contenthash, 3.1.10 合理使用preload、prefetch, 3.2 浏览器渲染优化策略, 3.2.1 关键渲染路径, 3.2.2 强制同步布局问题, 3.2.3 如何减少重排与重绘, 3.3 静态文件优化策略, 3.3.1 图片优化, 3.3.1.1 图片格式, 3.3.1.2 优化策略, 3.3.2 HTML优化, 3.3.3 CSS优化, 3.3.4 JS优化, 3.3.5 字体优化, 3.4 浏览器储存优化策略, 3.4.1 Cookie, 3.4.2 LocalStorage, 3.4.3 SessionStorage, 3.4.4 IndexDB, 3.5 其他优化策略, 3.6 使用PWA提高用户体验, 二、优化小技巧实操, 1.图片压缩, 1.1 图片多级压缩, 1.2 图片懒加载, 2.字体二级压缩, 2.1 使用 fonttools 压缩字体文件, 2.2 利用CloudConvert将TTF格式转换成woff2 格式, 3.css和js文件优化, 3.1 压缩css与js文件, 3.2 gulp批量压缩, 3.3 减少加载项, 4.无服务器下的资源加速策略, 4.1 可用的免费CDN选择, 4.2 免费图床推荐, 4.3 域名绑定的好处, 4.4 托管平台的选择, 5.实用工具, 5.1 Lighthouse, 5.1.1 性能（Performance）, 5.1.2 访问无障碍（Accessibility）, 5.1.3 最佳实践（优化）（Best Practice）, 5.1.4 搜索引擎优化（SEO）, 5.1.5 PWA（Progressive Web App）, 5.2 灵雀监控理论部分内容参考自页面全链路性能优化指南如果仅仅想进行优化不想花费太多时间了解原理可以直接跳到第二部分一理论部分浏览器渲染原理我们需要知道浏览器是如何渲染一个页面的我们才能知道如何对页面进行性能优化所以这里我们对一些基础知识进行讲解进程与线程浏览器有多种进程其中最主要的种进程如下浏览器进程负责界面展示用户交互子进程管理提供存储等渲染进程每个页面都有一个单独的渲染进程用于渲染页面包含线程网络进程主要处理网络资源加载等进程绘制提高性能插件进程插件每个插件占用一个进程输入到页面展示完整过程用户输入用户在浏览器进程输入并按下回车健后浏览器判断用户输入的是否为正确的如果不是则使用默认的搜索引擎将该关键字拼接成卸载原页面并重定向到新页面然后浏览器会将现有页面卸载掉并重定向到用户新输入的页面也就是图中和流程此时浏览器会准备一个渲染进程用于渲染即将到来的页面和一个网络进程用于发送网络请求处理如果当前页面注册了那么它可以拦截当前网站所有的请求进行判断是否需要向远程发送网络请求也就是图中与步骤如果不需要发送网络请求则取本地文件如果需要则进行下一步网络请求根据查询本地是否已经有强制缓存如果有则判断缓存是否过期如果没过期则直接返回缓存内容也就是图中步骤如果没有强制缓存或者缓存已过期则将该请求加入队列进行排队准备发送网络请求也就是图中正在排队然后进入解析阶段也就是图中以及图中的查找根据域名解析出对应的地址基于使用寻址找到对方然后根据地址端口号创建一个连接三次握手也就是图中以及图中的初始连接创建完成后利用连接来传输数据会将数据拆分为多个数据包进行有序传输如果丢包会重发的特点是可靠有序判断当前协议是否为如果为则进行协商将数据进行加密如果为协议则不进行加密明文传输也就是图中的开始发送请求请求行请求头请求体也就是图中以及图中的已发送请求协议有多个版本目前使用最多的版本为发送完成后默认不会断开默认打开为了下次传输数据时复用上次创建的连接每个域名最多同时建立个连接所以同一时间最多发生个请求服务器收到数据后解析请求请求行请求头请求体处理完成后生成状态码和响应响应行响应头响应体后返回给客户端也就是图的等待中在做的事情客户端接收到响应后根据状态码进行对应的处理如果状态码为则直接代表协商缓存生效直接取本地的缓存文件如果不是则下载内容也就是图中以及图中的下载内容步骤服务端响应在网络请求第步中服务器收到请求后需要根据请求信息来进行解析并返回给客户端想要的数据这也就服务端响应服务端可以响应并返回给客户端很多种类型的资源这里主要介绍类型目前前端处理服务端响应请求主要分为服务端渲染与客户端渲染就是返回一个空的模版然后浏览器加载后通过动态渲染页面是服务端在接受到请求时事先在服务端渲染好返回给客户端后客户端再进行客户端激活在打开一个站点的首屏页的完整链路中使用服务端渲染时的速度要远大于客户端渲染并且对友好所以对于首屏加载速度比较敏感或者需要优化的站点来说使用是更好的选择浏览器渲染详细流程浏览器渲染详细流程主要在网络请求中的地步浏览器下载完内容后进行解析何渲染页面的流程渲染流程分为种情况中无任何相关标签相关标签在最顶部且在解析到内容标签时已经解析完相关标签相关标签在最顶部但在解析到内容标签时相关标签尚未解析完相关标签在最底部略浏览器处理每一帧的流程浏览器在渲染完页面之后还需要不间断的处理很多内容的比如动画用户事件定时器等因此当浏览器渲染完页面后还会在之后的每一帧到来时执行以下的流程处理用户事件先处理阻塞事件包括和事件后处理非阻塞事件包括和处理完用户事件后执行定时器处理完定时器后开始进行每帧事件的处理包括窗口大小改变滚动媒体查询的更改动画事件处理完帧事件后执行回调函数和回调函数然后重新计算样式更新布局调整回调的大小然后合成更新性能优化相关工具了解完浏览器渲染原理我们还需要知道根据哪些指标才能判断一个页面性能的好坏在中这些指标应该怎么获取以及都为我们提供了哪些性能相关的工具如何使用性能既是一个工具可用于性能检测同样又是一套可在中执行工具的使用打开调试面板选择中文版为性能点击刷新按钮会刷新并录制当前页面然后我们就可以在面板中看到如下的各种性能相关细节使用获取性能相关指标接下来我们来了解一下目前常用的性能指标并且我们需要知道其中一些关键指标如何用获取首字节时间从发送请求到数据返回第一个字节所消耗的时间首次绘制第一个像素绘制到页面上的时间首次内容绘制标记浏览器渲染来自第一位内容的时间点该内容可能是文本图像甚至元素首次有效绘制例如在观看页面上主视频就是主角元素图片可以没加载完成但整体的骨架已经加载完成了秒内完成的概率超过那就代表这个网站是一个性能较好的网站可交互时间树构建完毕可以绑定事件的时间最大内容渲染代表在中最大的页面元素加载的时间的数据会通过对象记录每次出现更大的内容渲染则会产生一个新的对象年月新增当文档被完全加载和解析完成之后事件被触发无需等待样式表图像和子框架的完成加载当依赖的资源图片文件等全部加载完毕之后才会触发当依赖的资源图片文件等全部加载完毕之后才会触发页面阻塞总时长汇总所有加载过程中阻塞用户操作的时长在和之间任何中阻塞部分都会被汇总累积布局偏移总结起来就是一个元素初始时和其之间的任何时间如果元素偏移了则会被计算进去具体的计算方法可看这篇文章指标用于显示页面可见部分的显示速度单位是时间覆盖率获取代码未使用占比获取代码未使用占比获取性能报告并查看推荐优化项可以在本地安装命令行工具来使用也可以通过来使用网络网络请求中的时间能获取网络请求的时间消耗细节可以根据耗时来决定优化策略优先优化耗时最长的正在排队网络请求队列的排队时间已停止阻塞住用于处理其他事情的时间查找用于解析地址的时间初始连接创建连接时间用于协商的时间已发送请求用于发送请求的时间等待中请求发出至接收响应的时间也可以理解为服务端处理请求的时间下载内容下载响应的时间网络请求的优先级浏览器会根据资源的类型决定优先请求哪些资源优先级高的请求能够优先被加载不同资源类型的优先级排序如下最高高低网页总资源信息个请求网页一共多少个请求项资源网页资源一共大小毫秒加载完毕的时长加载时间秒完毕的时长配置网页性能优化上面我们分别讲解了进程与线程浏览器打开一个页面的完整过程浏览器处理每一帧时的流程性能相关的各种工具以及性能相关的各种指标以上内容都掌握之后我们再考虑性能优化遍有了思路我们在页面展示的任意一个步骤中对其进行优化都能对整个网页的展示性能产生影响下面列出了一个页面能优化的所有内容读者可根据自己的业务情况结合性能工具来做适合自己的优化方式网络优化策略减少请求数合并合并合理内嵌和使用雪碧图使用缓存使用强制缓存可以不走网络请求直接走本地缓存数据来加载资源使用协商缓存可以减少数据传输当不需要更新数据时可通知客户端直接使用本地缓存使用使用同一个连接来发送数据他把多个请求通过二进制分贞层实现了分贞然后把数据传输给服务器也叫多路复用多个请求复用同一个连接会将所有以开头的请求头做一个映射表然后使用进行压缩使用这种方式会使请求头更小服务器可主动推送数据给客户端避免重定向重定向会降低响应速度使用请求虽然占用的带宽较少但会有很高的延迟由其在移动端网络会更加明显使用可以对网站中使用到的域名提前进行解析提高资源加载速度通过预解析技术可以很好的降低延迟在访问以图片为主的移动端网站时使用预解析的情意中下页面加载时间可以减少使用域名分片在中一个域名同时最多创建个连接将资源放在多个域名下可提高请求的并发数静态资源全上能非常有效的加快网站静态资源的访问速度压缩压缩压缩压缩压缩图片压缩使用可以根据文件内容在文件名中加可用于浏览器缓存文件当文件没有改变时便直接取本地缓存数据合理使用两者都不会阻塞事件会在页面空闲时候再进行加载是提前预加载之后可能要用到的资源不一定是当前页面使用的预加载的是当前页面的资源如上代码预加载了但并没有使用浏览器在页面完成一段时间后发现还没有引用预加载的资源时浏览器会在控制台输出下图的提示信息和可根据资源类型决定资源加载的优先级详细优先级如代码最高高低浏览器渲染优化策略关键渲染路径当通过或者其他任意方式修改后浏览器会进入如下流程通过修改计算样式布局重排绘制重绘合成重排重排在中叫做布局通常添加或删除元素修改元素大小移动元素位置获取位置信息都会触发页面的重排因为重排可能会改变元素的大小位置等信息这样的改变会影响到页面大量其它元素的大小位置信息会耗费掉大量的性能所以在实际应用中我们应该尽可能的减少重排重绘重绘在中叫做绘制通常样式改变但没有影响位置时会触发重绘操作重绘性能还好但我们也需要尽量减少重绘如果需要做一些动画我们尽量使用动画动画只需要在初始化时绘制一次之后的动画都不会触发重绘操作强制同步布局问题在同一个函数内修改元素后又获取元素的位置时会触发强制同步布局影响渲染性能强制同步布局会使强制将计算样式和布局重排操作提前到当前函数任务中这样会导致每次运行时执行一次计算样式和重排这样一定会影响页面渲染性能而正常情况下计算样式和重排操作会在函数结束后统一执行如何减少重排与重绘脱离文档流绝对定位固定定位脱离文档流的元素进行重排不会影响到其他元素图片渲染时增加宽高属性宽高固定后图片不会根据内容动态改变高度便不会触发重排尽量用动画动画能最大程度减少重排与重绘使用将元素独立为一个单独的图层定位透明都会产生独立图层静态文件优化策略图片优化图片格式适合色彩丰富的图图不适合图形文字图标不支持透明度适合纯色透明图标支持纯透明和半透明不适合色彩丰富图片因为无损储存会导致储存体积大于适合动画可以动的图标支持纯透明但不支持半透明不适合色彩丰富的图片埋点信息通常也会使用发送因为的图发送的网络请求比普通的请求要小一些支持纯透明和半透明可以保证图片质量和较小的体积适合和移动端浏览器不适合其他浏览器矢量格式大小非常小但渲染成本过高适合小且色彩单一的图标优化策略减少图片资源的尺寸和大小节约用户流量设置属性图像无法显示时会显示内容图片懒加载为原生建议使用自己做懒加载不同环境加载不同尺寸和像素的图片与的使用采用渐进式加载先加载占位图然后加载模糊小图最后加载真正清晰的图使用减少图片请求数采用雪碧图合并图片减少请求数优化语义化代码简洁清晰利于便于开发维护减少嵌套关系减少节点数量提前声明字符编码让浏览器快速确定如何渲染网页内容删除多余空格空行注释无用属性减少子会阻塞父级的事件可以使用动态给赋值就能解决这个问题避免布局优化减少伪类选择器减少选择器层数减少通配符选择器减少正则选择器避免表达式删除空格空行注释减少无意义的单位压缩外链能走缓存添加媒体字段只加载有效的文件使用属性能控制对应元素是否根据子集元素的改变进行重排减少使用因为它使用串行加载优化通过的属性异步加载不阻塞渲染减少操作缓存访问过的元素不直接操作真实可以先修改然后一次性应用到上虚拟碎片节点使用解决复杂运算避免复杂运算阻塞主线程线程位于渲染进程图片懒加载使用实现虚拟滚动使用来做动画使用来进行空闲时的任务处理尽量避免使用性能差使用事件委托能减少事件绑定个数事件越多性能越差尽量使用动画通过覆盖率工具排查代码中未使用过的代码并将其删除通过性能工具查看每个函数的执行性能并优化字体优化等待一段时间如果没加载完成先显示默认加载后再进行切换字体加载完毕后显示加载超时降级系统字体白屏内不显示如果没加载完毕用默认的显示老字体在替换缩短不显示时间如果没加载完毕用默认的和类似替换可能用字体可能不替换浏览器储存优化策略在过期之前一直有效最大储存大小为限制字段个数不适合大量的数据储存每次请求会携带主要用来做身份校验优化方式需要合理设置有效期根据不同子域划分来减少传输静态资源域名和域名采用不同域名避免静态资源请求携带下最多储存除非手动清除否则一直存在可以利用储存静态资源比如储存网页的这样会使页面打开速度非常快例如百度会话级别储存可用于页面间的传值浏览器的本地数据库大小几乎无上限其他优化策略关键资源个数越多首次页面加载时间就会越长关键资源的大小内容越小下载时间越短优化白屏合理使用内联预渲染打包时进行预渲染生成静态文件用户访问时直接返回静态服务端渲染同构加速首屏速度耗费服务端资源有利于优化首屏使用服务端渲染后续交互使用客户端渲染使用提高用户体验用户体验差的一大原因是不能离线访问用户粘性低的一大原因是无法保存入口就是为了解决的用户体验问题而诞生的使用能令站点拥有快速可靠安全等特性将网站添加到电脑桌面手机桌面类似的体验配合能做到离线缓存各种内容配合能做到类似的消息推送与实时提醒配合能做壳与骨架屏二优化小技巧实操图片压缩图片多级压缩目前从网上下载的图片主流格式是或者当分辨率比较高的时候体积往往比较大因此要想提高网站的速度就有必要将图片体积压缩这里参考店长的推荐无损压缩推荐有损压缩推荐特点无损压缩有损压缩以牺牲图像质量降低图像色彩来达到缩减图像大小的目的优点能够完全保留图像色彩不损伤图像质量压缩程度高支持转为或进一步减少图片大小软件支持一次处理多张图片无上限处理完成支持直接批量覆盖原文件或重命名缺点单次仅能上传张图片每张限制大小为无法处理更大图片转其他格式为不可逆操作指覆盖保存后且可能反而会增加图片大小在这里还给大家推荐一个非常实用的网站这个网站不仅仅支持将与格式的图片批量完全没有数量限制那种转化为和推荐的一种压缩率更高的编码方式而且还能改变图片的原始分辨率甚至将图片压缩到指定的大小下面演示了一张图压缩之路我们选择了将转化为格式画质为图片规模缩小为压缩率达到而选择将转化为格式画质为图片规模缩小为压缩率达到这样下来我们可以把所有图片几乎都可以控制在以下而且肉眼观察画质没有明显的不同使用建议如果没有特别要求直接使用进行有损压缩即可虽然说是有损压缩但是默认压缩会自主计算压缩程度一般默认程度就能节省空间且肉眼几乎发现不了图片压缩情况同时我个人是比较推荐一步到位直接压缩成格式虽然在一些未适配的浏览器例如浏览器上可能出现无法查看图片的情况但是压缩率是真的高图片一路下来压缩个毫无压力如果对图片分辨率要求不太高或者图片分辨率原本就太高了可以考虑缩小分辨率结合上面几项甚至可以压缩的大小图片懒加载图片懒加载是指只加载目前能看到及其附近的页面上的图片有节省流量与提高性能的作用主题内置了图片懒加载的选项在文件下将对应项设置为如下即可圖片懶加載选择在哪些地方启用图片懒加载你自己喜欢的图片模糊效果字体二级压缩我们从网上下载的字体通常都是格式是一种字库名称是公司和公司共同推出的字体文件格式也是最常用的格式之一但是一些好看的字体往往体积都会很大网站每次进去都要加载一个这么大的文件速度肯定会很慢例如下面这个筑紫丸的标准体格式的字体文件体积约为这部分参考有效的压缩字体方法一个有效的压缩方法是编码压缩转格式二级压缩使用压缩字体文件需要环境并已安装好使用来安装下载已经整理好的字体编码列表文件点这里进行下载将你要压缩的字体文件和刚刚下载的编码文件放进去同一个文件夹进入到该文件夹的控制台如下命令然后回车然后就会得到图片所示的结尾的编码压缩后的文件体检体积已经从下降到利用将格式转换成格式进去国外平台国内速度可能会慢一些将格式的字体文件转化为格式最后压缩成从的文件压缩成足足压缩了十几倍压缩率十分高和文件优化压缩与文件如果是用进行网站搭建的小伙伴可以下载插件该插件支持将和文件的格式进行压缩降低文件体积使用方法安装插件后在和文件界面右键选择插件会生成一个文件名为或者的文件这就是压缩后的文件在引入的时候直接引用这个压缩后的文件即可批量压缩这是压缩全局静态资源的教程可以参考店长的文章使用压缩博客静态资源减少加载项当网站的东西多起来了之后会越来越卡顿这时候推荐以下几个优化方向减少卡片的出场动画元素等其中是比较消耗资源的如果部分和文件只有部分页面需要引用尽量不全局引用同时删除空格空行注释减少无意义的单位文件尽量添加字段指定加载设备文件的引入可以加入的属性异步加载不阻塞渲染无服务器下的资源加速策略可用的免费选择官网地址轻松地从等加载您的项目没有流量限制或限制文件通过超快速全球提供在不是分支中使用特定标记或提交哈希根据永久缓存文件除分支外文件在浏览器中缓存年具体用法直接从或提供原始文件官网地址具体用法和上面的很类似主分支版本分支轻量级私人申请见见免费图床推荐目前我是用的公共仓库部署加速速度还可以关键是支持增量更新和自动部署不过前期的配置比较麻烦点你也可以选用公共仓库部署加速速度和接近大概步骤就是建立一个公共仓库把你本地的图片推上这个仓库然后将这个仓库部署托管于再用一个二级域名绑定这个部署那就可以通过二级域名路径的方式访问到图片与资源了每次仓库更新导致指定分支更新都会触发重新部署实现自动化流程这部分教程以后有机会详细写如果不想折腾或者只想存少量不太重要的图片那么完全可以用公共的免费图床下面列举了一些免费的图床聚合图床遇见图床路过图床域名绑定的好处目前的域已经被墙了如果想用托管网站又想在国内访问又不想科学上网只能绑定国内域名还有想用来进行资源加速也必须是有国内域名的同时域名还可以拥有自己的域名邮箱与网站标识符总之域名还是很有用的对于静态网站来说你可以没有服务器但是你不能没有域名托管平台的选择目前能够托管静态网站的平台有以下几个不限量速度较快推荐指数不限量速度还可以推荐指数流量限制速度还可以适合做备用线路推荐指数流量限制速度还可以适合做备用线路推荐指数不限量速度较慢推荐指数不限量速度还可以但是与国外平台兼容性差推荐指数还有其他的例如等就不说了估计没啥人用实用工具是一个网站性能测评工具它是推出的一个开源自动化工具能够对和网页多方面的效果指标进行评测并给出最佳实践的建议以帮助开发者改进网站的质量它的使用方法也非常简单我们只需要提供一个要测评的网址它将针对此页面运行一系列的测试然后生成一个有关页面性能的报告通过报告我们就可以知道需要采取哪些措施来改进应用的性能和体验在高版本应该是的浏览器中已经直接集成到了调试工具中了因此不需要进行任何安装或下载按打开开发者工具可以看到在等选项后面有一个安装了插件或者是高版本的谷歌浏览器可能显示的是选项选择该选项然后点击即可使用对网站进行测评后我们会得到一份评分报告它包含了性能访问无障碍最佳实践搜索引擎优化五个部分性能性能评分的分值区间是到如果出现分通常是在运行时发生了错误满分分代表了网站已经达到了分位值的数据而分则是分位值的数据影响评分的性能指标性能测试结果会分成三部分但只有部分的指标项会对分数产生直接影响会衡量以下性能指标项首次内容绘制即浏览器首次将任意内容如文字图像等绘制到屏幕上的时间点首次有效绘制衡量了用户感知页面的主要内容可见的时间对于不同的站点首要内容是不同的例如对于博客文章标题及首屏文字是首要内容而对于购物网站来说图片也会变得很重要首次空闲即页面首次能够对输入做出反应的时间点其出现时机往往在首次有效绘制完成之后该指标目前仍处于实验阶段可交互时间指的是所有的页面内容都已经成功加载且能够快速地对用户的操作做出反应的时间点该指标目前仍处于实验阶段速度指标衡量了首屏可见内容绘制在屏幕上的速度在首次加载页面的过程中尽量展现更多的内容往往能给用户带来更好的体验所以速度指标的值约小越好输入延迟估值这个指标衡量了页面对用户输入行为的反应速度其基准值应低于部分的指标项会直接影响分数可以作为我们的主要参考点另外的两部分中指的是优化机会它提供了详细的建议和文档来解释低分的原因帮助我们具体进行实现和改进指的是现在存在的问题为进一步改善性能的实验和调整给出了指导这两者不会纳入分数的计算每一项性能指标对评分的贡献都有其计算逻辑会将原始的性能值映射成为之间的数字例如的原始值是从页面初始化开始到主要内容渲染成功的耗时根据真实站点的数据顶级性能的站点的值约为这个值会被映射成的分针对不同的评分用了不同的颜色进行标注分值区间和颜色的对应关系如下慢红色平均值橙色快绿色访问无障碍访问无障碍评分的分值由相关指标的加权平均值计算而来可以在评分详情查阅每项指标的具体权重同理较大权重的指标项对分数的影响较大无障碍性的每个指标项测试结果为或者与性能指标项的计算方式不同当页面只是部分通过某项指标时页面的这项指标将不会得分例如如果页面中的一些元素有屏幕阅读器友好的命名而其他的元素没有那么这个页面的指标项得分为最佳实践优化最佳实践评分的分数区间为影响这项评分的指标项的权重都是相同的比如推荐使用跨域的跳转链接需要使用标识不能使用废弃的等等搜索引擎优化比如图片元素使用属性等等提高搜索引擎搜索排名便于搜索引擎能找到你这个网站使用基准检查项列表进行测评测评结果将这些指标项分成了四个类别共包含个自动测试项和个手动测试项其中各个自动测试项的评分权重是相同的的评测指标对我们来说非常重要我们可以从这四个类别详细了解一下基准指标项快速可靠页面在移动网络条件下能够快速加载在离线条件下页面能够返回状态码这里我们可以通过来实现离线可用在离线条件下返回状态码是前面章节我们提到过的中的一个属性它指定了用户打开该时加载的可安装始终使用注册来缓存页面以及使用文件来实现安装的需求浏览器能够主动通知用户将应用添加到桌面增加留存率优化将流量重定向到配置自定义启动画面设置地址栏主题颜色页面内容针对视口大小自适应对移动用户的展示更友好使用了标签并设置了或属性当文件不可用时提供降级措施页面能显示基本内容而不出现白屏手动测试项站点跨浏览器可用如主流浏览器及等页面间切换流畅即使在较差的网络环境下切换动画也应该简洁顺畅这是提高用户感知体验的关键保证每个页面都有独一无二的能够在新的浏览器窗口打开且方便在社交媒体上进行分享除了上述基准指标项之外为了让的体验更加完美还有一些未实现检查的进阶指标也就是可以作为示范性参考的的指标比如用户体验缓存推送通知等等灵雀监控灵雀应用监控平台最国内老牌知名免费网站统计网站统计旗下的一个性能与监控工具平台发布后在站长圈内也有一些较好的评价访问地址灵雀应用监控平台专注于帮您及时发现异常问题帮助运营人员发现网站风险协助开发者修复网页从而提升用户体验产品面向产品运营以及开发人员作为网站性能及异常信息收集工具开发人员可以通过页面统计获取用户平均的页面统计信息和网页的各个性能指标进行分析如解析时间服务器响应时间白屏时间页面完全加载时长等是否达标等判断灵雀应用监控平台为开发人员提供了包含程序异常收集性能分析资源异常分析页面外链跳转分析可疑脚本监控等网站优化和用户体验改进所需的信息特点大家是否有遇到过下面这些情况网站打开速度慢找不到原因部分访客无法打开网站又不能及时得到反馈网站突然无流量或被却无从查起起因异常分析精准定位实时监控网站发生的程序错误网络请求异常资源加载异常等潜在问题精准采集错误上报的页面错误发生时间等详细的用户设备数据帮您快速定位异常提高效率性能监测定向优化采用网站统计的多维分析技术详细展示分析网站性能加载状况确定网站体验优化方向外链监控规避暗链提供小时全方位监控站内外链的功能定位异常跳转助您快速识别暗链链接降低网站被风险提升网站安全性',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-02-11 00:53:23',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 8 || hour >= 22
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><style id="themeColor"></style><style id="rightSide"></style><style id="transPercent"></style><style id="blurNum"></style><style id="settingStyle"></style><span id="fps"></span><style id="defineBg"></style><link rel="stylesheet" href="/css/cat.css"><link rel="stylesheet" href="/css/cursor.css"><link rel="stylesheet" href="/css/fps.css"><link rel="stylesheet" href="/css/gamecard.css?1"><link rel="stylesheet" href="/css/home.css"><link rel="stylesheet" href="/css/imgloaded.css?1"><link rel="stylesheet" href="/css/meihua.css"><link rel="stylesheet" href="/css/todolist.css"><link rel="stylesheet" href="/css/valine.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_2264842_b004iy0kk2b.css" media="defer" onload="this.media='all'"><div id="myscoll"></div><!-- hexo injector head_end start --><link rel="stylesheet" href="https://jsd.cdn.storisinz.site/npm/hexo-butterfly-games/lib/games.css"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu@1.1.6/lib/clock.min.css" /><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="XIAOZE" type="application/atom+xml">
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/img/woqishanyi.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">趣味</div><div class="back-menu-list"><a class="back-menu-item" href="/beauty/" title="养眼视频"><img class="back-menu-item-icon" src="/img/mobile1.png" alt="养眼视频"/><span class="back-menu-item-text">养眼视频</span></a><a class="back-menu-item" href="/air-conditioner/" title="小空调"><img class="back-menu-item-icon" src="/img/mobile2.png" alt="小空调"/><span class="back-menu-item-text">小空调</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">图片</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://haowallpaper.com/homeView" title="哲风壁纸"><img class="back-menu-item-icon" src="/img/mobile3.png" alt="哲风壁纸"/><span class="back-menu-item-text">哲风壁纸</span></a><a class="back-menu-item" href="/picture/" title="随机壁纸"><img class="back-menu-item-icon" src="/img/pc2.png" alt="随机壁纸"/><span class="back-menu-item-text">随机壁纸</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">anzhiyu</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://index.anheyu.com/" title="个人主页"><img class="back-menu-item-icon" src="https://bu.dusays.com/2023/08/13/64d8c2748ef34.jpg" alt="个人主页"/><span class="back-menu-item-text">个人主页</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src="https://bu.dusays.com/2023/07/23/64bc72c75319d.png" alt="博客"/><span class="back-menu-item-text">博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="图床"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="图床"/><span class="back-menu-item-text">图床</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">XIAOZE</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="anzhiyufont anzhiyu-icon-zonglan faa-tada" style="font-size: 0.9em;"></i><span> 统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/update/"><i class="anzhiyufont anzhiyu-icon-history faa-tada" style="font-size: 0.9em;"></i><span> 本站日志</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?id=2963512140&amp;server=tencent"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/cinemas/"><i class="anzhiyufont anzhiyu-icon-fw-eye faa-tada" style="font-size: 0.9em;"></i><span> 追剧页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 我的装备</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/games/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-game"></use></svg><span> 游戏人生</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/todolist/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> TODOlist</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/diary/"><i class="anzhiyufont anzhiyu-icon-book faa-tada" style="font-size: 0.9em;"></i><span> 日记</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 功能</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/beauty/"><i class="anzhiyufont anzhiyu-icon-heartbeat faa-tada" style="font-size: 0.9em;"></i><span> 养眼</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/picture/"><i class="anzhiyufont anzhiyu-icon-heartbeat faa-tada" style="font-size: 0.9em;"></i><span> 壁纸</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="meihua_button"><a class="site-page" onclick="toggleWinbox()" title="美化设置-自定义你的风格" id="meihua-button" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-plant-fill"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="/img/wechat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="/img/wechat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/ali.jpg" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="/img/ali.jpg"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CDN/" style="font-size: 1.05rem;">CDN<sup>1</sup></a><a href="/tags/Git/" style="font-size: 1.05rem;">Git<sup>1</sup></a><a href="/tags/Markdown/" style="font-size: 1.05rem;">Markdown<sup>1</sup></a><a href="/tags/hexo/" style="font-size: 1.05rem; font-weight: 500; color: var(--anzhiyu-lighttext)">hexo<sup>28</sup></a><a href="/tags/test/" style="font-size: 1.05rem;">test<sup>1</sup></a><a href="/tags/web/" style="font-size: 1.05rem;">web<sup>1</sup></a><a href="/tags/%E5%A4%96%E6%8C%82%E6%A0%87%E7%AD%BE/" style="font-size: 1.05rem;">外挂标签<sup>1</sup></a><a href="/tags/%E5%A4%A7%E5%AD%A6/" style="font-size: 1.05rem;">大学<sup>2</sup></a><a href="/tags/%E9%AD%94%E6%94%B9/" style="font-size: 1.05rem;">魔改<sup>17</sup></a><a href="/tags/%E9%AD%94%E6%B3%95/" style="font-size: 1.05rem;">魔法<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">15</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/01/"><span class="card-archive-list-date">一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">21</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div><div class="console-btn-item" id="consoleKeyboard" onclick="anzhiyu.keyboardToggle()" title="快捷键开关"><a class="keyboard-switch"><i class="anzhiyufont anzhiyu-icon-keyboard"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">转载</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%B1%87%E6%80%BB%E8%AE%B0%E5%BD%95/" itemprop="url">汇总记录</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/hexo/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>hexo</span></a><a class="article-meta__tags" href="/tags/web/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>web</span></a></span></div></div><h1 class="post-title" itemprop="name headline">网站性能优化的一些小技巧</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-02-10T13:59:03.000Z" title="发表于 2025-02-10 21:59:03">2025-02-10</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-02-10T16:53:23.293Z" title="更新于 2025-02-11 00:53:23">2025-02-11</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">11.3k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>38分钟</span></span><span class="post-meta-separator"></span><span id="" data-flag-title="网站性能优化的一些小技巧"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="twikoo_visitors" title="访问量"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为西安"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>西安</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://npm.elemecdn.com/ushio-api-img-moe@5.0.42/img_424_1920x1080_72_null_normal.jpg?_r_=f0c0bcf4-503c-3875-0672-a5a58d3318ef"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://www.fomal.cc/posts/b48804d5.html"><header><a class="post-meta-categories" href="/categories/%E6%B1%87%E6%80%BB%E8%AE%B0%E5%BD%95/" itemprop="url">汇总记录</a><a href="/tags/hexo/" tabindex="-1" itemprop="url">hexo</a><a href="/tags/web/" tabindex="-1" itemprop="url">web</a><h1 id="CrawlerTitle" itemprop="name headline">网站性能优化的一些小技巧</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Fomalhaut🥝</span><time itemprop="dateCreated datePublished" datetime="2025-02-10T13:59:03.000Z" title="发表于 2025-02-10 21:59:03">2025-02-10</time><time itemprop="dateCreated datePublished" datetime="2025-02-10T16:53:23.293Z" title="更新于 2025-02-11 00:53:23">2025-02-11</time></header><article class="post-content" id="article-container"><div class="note info flat"><p>理论部分内容参考自：<a target="_blank" rel="noopener" href="https://tzy1997.com/articles/we0522bs/">Web页面全链路性能优化指南</a>，如果仅仅想进行优化不想花费太多时间了解原理可以直接跳到第二部分</p></div><h1 id="一、理论部分">一、理论部分</h1><h2 id="1-浏览器渲染原理">1.浏览器渲染原理</h2><p>我们需要知道浏览器是如何渲染一个页面的，我们才能知道如何对页面进行性能优化，所以这里我们对一些基础知识进行讲解。</p><h3 id="1-1-进程与线程">1.1 进程与线程</h3><p>浏览器有多种进程，其中最主要的5种进程如下：</p><p><a target="_blank" rel="noopener" href="https://bu.dusays.com/2022/05/23/628b96c2e0bec.webp" data-fancybox="gallery" data-caption="p1" data-thumb="https://bu.dusays.com/2022/05/23/628b96c2e0bec.webp"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/05/23/628b96c2e0bec.webp" alt="p1"></a></p><ol><li>浏览器进程 负责界面展示、用户交互、子进程管理、提供存储等</li><li>渲染进程 每个页面都有一个单独的渲染进程，用于渲染页面，包含webworker线程</li><li>网络进程 主要处理网络资源加载（HTML、CSS、JS、IMAGE、AJAX等）</li><li>GPU进程 3D绘制，提高性能</li><li>插件进程 chrome插件，每个插件占用一个进程</li></ol><h3 id="1-2-输入url到页面展示完整过程">1.2 输入url到页面展示完整过程</h3><p><a target="_blank" rel="noopener" href="https://bu.dusays.com/2022/05/23/628b9dcaedcbd.jpg" data-fancybox="gallery" data-caption="p2" data-thumb="https://bu.dusays.com/2022/05/23/628b9dcaedcbd.jpg"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/05/23/628b9dcaedcbd.jpg" alt="p2"></a></p><h4 id="1-2-1-用户输入">1.2.1 用户输入</h4><p>用户在浏览器进程输入并按下回车健后，浏览器判断用户输入的url是否为正确的url，如果不是，则使用默认的搜索引擎将该关键字拼接成url。</p><h4 id="1-2-2-卸载原页面并重定向到新页面">1.2.2 卸载原页面并重定向到新页面</h4><p>然后浏览器会将现有页面卸载掉并重定向到用户新输入的url页面，也就是图中【Process Unload Event】和【Redirect】流程。</p><p>此时浏览器会准备一个渲染进程用于渲染即将到来的页面，和一个网络进程用于发送网络请求。</p><h4 id="1-2-3-处理Service-Worker">1.2.3 处理Service Worker</h4><p>如果当前页面注册了Service Worker那么它可以拦截当前网站所有的请求，进行判断是否需要向远程发送网络请求。也就是图中【Service Worker Init】与【Service Worker Fecth Event 】步骤</p><p>如果不需要发送网络请求，则取本地文件。如果需要则进行下一步。</p><h4 id="1-2-4-网络请求">1.2.4 网络请求</h4><p><a target="_blank" rel="noopener" href="https://bu.dusays.com/2022/05/23/628b99a83152f.webp" data-fancybox="gallery" data-caption="p3" data-thumb="https://bu.dusays.com/2022/05/23/628b99a83152f.webp"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/05/23/628b99a83152f.webp" alt="p3"></a></p><ol><li>根据url查询本地是否已经有强制缓存，如果有则判断缓存是否过期，如果没过期则直接返回缓存内容，也就是图1中【HTTP Cache】步骤</li><li>如果没有强制缓存或者缓存已过期，则将该请求加入队列进行排队准备发送网络请求，也就是图2中【正在排队】，然后进入DNS解析阶段，也就是图1中【DNS】以及图2中的【DNS查找】，DNS根据域名解析出对应的IP地址。(DNS基于UDP)。</li><li>使用IP寻址找到对方，然后根据IP地址+端口号创建一个TCP连接(三次握手)，也就是图1中【TCP】以及图2中的【初始连接】创建完成后利用TCP连接来传输数据。(TCP会将数据拆分为多个数据包，进行有序传输，如果丢包会重发，TCP的特点是可靠、有序)</li><li>判断当前协议是否为https，如果为https，则进行SSL协商，将数据进行加密，如果为http协议则不进行加密(明文传输)，也就是图2中的【SSL】。</li><li>开始发送http请求(请求行/请求头/请求体)，也就是图1中【Request】以及图2中的【已发送请求】。HTTP协议有多个版本，目前使用最多的版本为HTTP/1.1，HTTP/1.1发送完成后默认不会断开。keep-alive 默认打开，为了下次传输数据时复用上次创建的连接。每个域名最多同时建立6个TCP连接，所以同一时间最多发生6个请求。</li><li>服务器收到数据后解析HTTP请求(请求行/请求头/请求体)，处理完成后生成状态码和HTTP响应(响应行/响应头/响应体)后返回给客户端，也就是图2的【等待中】在做的事情。</li><li>客户端接收到HTTP响应后根据状态码进行对应的处理，如果状态码为304则直接代表协商缓存生效，直接取本地的缓存文件。如果不是则下载内容。也就是图1中【Response】以及图2中的【下载内容】步骤。</li></ol><h4 id="1-2-5-服务端响应">1.2.5 服务端响应</h4><p>在网络请求第6步中，服务器收到HTTP请求后需要根据请求信息来进行解析，并返回给客户端想要的数据，这也就服务端响应。</p><p>服务端可以响应并返回给客户端很多种类型的资源，这里主要介绍html类型。</p><p>目前前端处理服务端响应html请求主要分为SSR服务端渲染与CSR客户端渲染，CSR就是返回一个空的HTML模版，然后浏览器加载js后通过js动态渲染页面。SSR是服务端在接受到请求时事先在服务端渲染好html返回给客户端后，客户端再进行客户端激活。</p><p>在打开一个站点的首屏页的完整链路中，使用SSR服务端渲染时的速度要远大于CSR客户端渲染，并且SSR对SEO友好。所以对于首屏加载速度比较敏感或者需要优化SEO的站点来说，使用SSR是更好的选择。</p><h4 id="1-2-6-浏览器渲染详细流程">1.2.6 浏览器渲染详细流程</h4><p>浏览器渲染详细流程主要在网络请求中的地7步。浏览器下载完html内容后进行解析何渲染页面的流程。<br><a target="_blank" rel="noopener" href="https://bu.dusays.com/2022/05/23/628ba7881b1a8.webp" data-fancybox="gallery" data-caption="p4" data-thumb="https://bu.dusays.com/2022/05/23/628ba7881b1a8.webp"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/05/23/628ba7881b1a8.webp" alt="p4"></a><br>渲染流程分为4种情况：</p><ol><li>HTML中无任何CSS相关标签</li><li>CSS相关标签在HTML最顶部，且在解析到内容标签<code>（&lt;div /&gt;）</code>时已经解析完CSS相关标签</li><li>CSS相关标签在HTML最顶部，但在解析到内容标签<code>（&lt;div /&gt;）</code>时CSS相关标签尚未解析完</li><li>CSS相关标签在HTML最底部<br>（略）</li></ol><h3 id="1-3-浏览器处理每一帧的流程">1.3 浏览器处理每一帧的流程</h3><p>浏览器在渲染完页面之后还需要不间断的处理很多内容的，比如动画、用户事件、定时器等。因此当浏览器渲染完页面后，还会在之后的每一帧到来时执行以下的流程。<br><a target="_blank" rel="noopener" href="https://bu.dusays.com/2022/05/24/628bb016bb39b.webp" data-fancybox="gallery" data-caption="p5" data-thumb="https://bu.dusays.com/2022/05/24/628bb016bb39b.webp"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/05/24/628bb016bb39b.webp" alt="p5"></a></p><ol><li>【Input events】处理用户事件，先处理【阻塞事件Blocking】包括touch和wheel事件，后处理【非阻塞事件Non-blocking】包括click和keypress。</li><li>【JS】处理完用户事件后执行【定时器Timers】</li><li>【Begin frame】处理完定时器后开始进行【每帧事件Per frame events】的处理，包括窗口大小改变、滚动、媒体查询的更改、动画事件。</li><li>【rAF】处理完帧事件后执行requestAnimationFrame回调函数和IntersectionObserver回调函数。</li><li>【Layout】然后【重新计算样式Recalc style】、【更新布局Update layout】、【调整Observer回调的大小Resize Observer callbacks】</li><li>【Paint】然后【合成更新Compositing update】、【Paint invalidation】、【Record】</li></ol><h2 id="2-Chrome性能优化相关工具">2.Chrome性能优化相关工具</h2><p>了解完浏览器渲染原理，我们还需要知道根据哪些指标才能判断一个页面性能的好坏，在Chrome中这些指标应该怎么获取。以及Chrome都为我们提供了哪些性能相关的工具，如何使用。</p><h3 id="2-1-Chrome-Performance-性能">2.1 Chrome Performance(性能)</h3><p>Performance既是一个Chrome工具，可用于性能检测。<br>同样又是一套JS API，可在Chrome中执行。</p><h4 id="2-1-1-Chrome-Performance-工具的使用">2.1.1 Chrome Performance 工具的使用</h4><p>打开Chrome调试面板选择Performance，中文版为性能，点击刷新按钮，Performance会刷新并录制当前页面，然后我们就可以在面板中看到如下的各种性能相关细节。<br><a target="_blank" rel="noopener" href="https://bu.dusays.com/2022/05/24/628bb12aad445.webp" data-fancybox="gallery" data-caption="p6" data-thumb="https://bu.dusays.com/2022/05/24/628bb12aad445.webp"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/05/24/628bb12aad445.webp" alt="p6"></a></p><h4 id="2-1-2-使用Performance-API获取性能相关指标">2.1.2 使用Performance API获取性能相关指标</h4><p>接下来我们来了解一下目前常用的性能指标，并且我们需要知道其中一些关键指标如何用Performance API获取。</p><ol><li>TTFB（Time To First Byte）首字节时间：从发送请求到数据返回第一个字节所消耗的时间。</li><li>FP (First Paint) 首次绘制: 第一个像素绘制到页面上的时间。</li><li>FCP (First Contentful Paint) 首次内容绘制: 标记浏览器渲染来自 DOM 第一位内容的时间点，该内容可能是文本、图像、SVG 甚至 元素。</li><li>FMP(First Meaningful Paint) 首次有效绘制: 例如，在 YouTube 观看页面上，主视频就是主角元素。<br>图片可以没加载完成，但整体的骨架已经加载完成了。<br>1秒内完成FMP的概率超过80%，那就代表这个网站是一个性能较好的网站。</li><li>TTI (Time to Interactive) 可交互时间 : DOM树构建完毕，可以绑定事件的时间</li><li>LCP (Largest Contentful Paint) 最大内容渲染: 代表在viewport中最大的页面元素加载的时间。LCP的数据会通过PerformanceEntry对象记录, 每次出现更大的内容渲染, 则会产生一个新的PerformanceEntry对象(2019年11月新增)。</li><li>DCL (DomContentloaded): 当 HTML 文档被完全加载和解析完成之后，DOMContentLoaded 事件被触发，无需等待样式表、图像和子框架的完成加载。</li><li>L (onLoad), 当依赖的资源(图片、文件等), 全部加载完毕之后才会触发。</li><li>L (onLoad), 当依赖的资源(图片、文件等), 全部加载完毕之后才会触发。</li><li>TBT (Total Blocking Time) 页面阻塞总时长: TBT汇总所有加载过程中阻塞用户操作的时长，在FCP和TTI之间任何long task中阻塞部分都会被汇总。</li><li>CLS (Cumulative Layout Shift) 累积布局偏移: 总结起来就是一个元素初始时和其hidden之间的任何时间如果元素偏移了, 则会被计算进去, 具体的计算方法可看这篇文章 <a target="_blank" rel="noopener" href="https://web.dev/cls/">https://web.dev/cls/</a></li><li>SI (Speed Index): 指标用于显示页面可见部分的显示速度, 单位是时间。</li></ol><h3 id="2-2-Coverage-覆盖率">2.2 Coverage(覆盖率)</h3><p>获取代码未使用占比。获取代码未使用占比<br><a target="_blank" rel="noopener" href="https://bu.dusays.com/2022/05/24/628bb981db5c8.webp" data-fancybox="gallery" data-caption="p7" data-thumb="https://bu.dusays.com/2022/05/24/628bb981db5c8.webp"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/05/24/628bb981db5c8.webp" alt="p7"></a></p><h3 id="2-3-Lighthouse">2.3 Lighthouse</h3><p>获取性能报告并查看推荐优化项。可以在本地安装命令行工具来使用，也可以通过Chrome来使用。<br><a target="_blank" rel="noopener" href="https://bu.dusays.com/2022/05/24/628cf77e139ff.webp" data-fancybox="gallery" data-caption="p8" data-thumb="https://bu.dusays.com/2022/05/24/628cf77e139ff.webp"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/05/24/628cf77e139ff.webp" alt="p8"></a></p><h3 id="2-4-Network-网络">2.4 Network(网络)</h3><h4 id="2-4-1-网络请求中的Timing-时间">2.4.1 网络请求中的Timing(时间)</h4><p>能获取网络请求的时间消耗细节，可以根据耗时来决定优化策略。优先优化耗时最长的。<br><a target="_blank" rel="noopener" href="https://bu.dusays.com/2022/05/24/628cf966b69da.webp" data-fancybox="gallery" data-caption="p9" data-thumb="https://bu.dusays.com/2022/05/24/628cf966b69da.webp"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/05/24/628cf966b69da.webp" alt="p9"></a></p><ul><li>正在排队：网络请求队列的排队时间</li><li>已停止：阻塞住用于处理其他事情的时间</li><li>DNS查找：用于DNS解析IP地址的时间</li><li>初始连接：创建TCP连接时间</li><li>SSL：用于SSL协商的时间</li><li>已发送请求：用于发送请求的时间</li><li>等待中：请求发出至接收响应的时间也可以理解为服务端处理请求的时间</li><li>下载内容：下载响应的时间</li></ul><h4 id="2-4-2-网络请求的优先级">2.4.2 网络请求的优先级</h4><p>浏览器会根据资源的类型决定优先请求哪些资源，优先级高的请求能够优先被加载。<br><a target="_blank" rel="noopener" href="https://bu.dusays.com/2022/05/24/628cf9efddd7f.webp" data-fancybox="gallery" data-caption="p10" data-thumb="https://bu.dusays.com/2022/05/24/628cf9efddd7f.webp"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/05/24/628cf9efddd7f.webp" alt="p10"></a><br>不同资源类型的优先级排序如下：</p><ul><li>最高：html、style</li><li>高：font、fetch、script</li><li>低：image、track</li></ul><h4 id="2-4-3-网页总资源信息">2.4.3 网页总资源信息</h4><p><a target="_blank" rel="noopener" href="https://bu.dusays.com/2022/05/24/628cfb20c1315.webp" data-fancybox="gallery" data-caption="p11" data-thumb="https://bu.dusays.com/2022/05/24/628cfb20c1315.webp"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/05/24/628cfb20c1315.webp" alt="p11"></a></p><ul><li>58个请求：网页一共多少个请求</li><li>6.9 MB 项资源：网页资源一共6.9MB大小</li><li>DOMContentLoaded 454 毫秒：DOM加载完毕的时长</li><li>加载时间 1.02 秒：onload完毕的时长</li></ul><h4 id="2-4-4-Network配置">2.4.4 Network配置</h4><p><a target="_blank" rel="noopener" href="https://bu.dusays.com/2022/05/24/628cfcbe97759.webp" data-fancybox="gallery" data-caption="p12" data-thumb="https://bu.dusays.com/2022/05/24/628cfcbe97759.webp"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/05/24/628cfcbe97759.webp" alt="p12"></a></p><h2 id="3-网页性能优化">3.网页性能优化</h2><p>上面我们分别讲解了进程与线程、浏览器打开一个页面的完整过程、浏览器处理每一帧时的流程、Chrome性能相关的各种工具以及性能相关的各种指标。以上内容都掌握之后我们再考虑性能优化遍有了思路，我们在页面展示的任意一个步骤中对其进行优化都能对整个网页的展示性能产生影响。</p><p>下面列出了一个页面能优化的所有内容，读者可根据自己的业务情况结合性能工具来做适合自己的优化方式。</p><h3 id="3-1-网络优化策略">3.1 网络优化策略</h3><h4 id="3-1-1-减少HTTP请求数">3.1.1 减少HTTP请求数</h4><p>合并JS、合并CSS、合理内嵌JS和CSS、使用雪碧图。</p><h4 id="3-1-2-使用HTTP缓存">3.1.2 使用HTTP缓存</h4><p>使用强制缓存可以不走网络请求，直接走本地缓存数据来加载资源。</p><p>使用协商缓存可以减少数据传输，当不需要更新数据时可通知客户端直接使用本地缓存。</p><h4 id="3-1-3-使用-HTTP-2-0">3.1.3 使用 HTTP/2.0</h4><p>HTTP/2.0使用同一个TCP连接来发送数据，他把多个请求通过二进制分贞层实现了分贞，然后把数据传输给服务器。也叫多路复用，多个请求复用同一个TCP连接。</p><p>HTTP/2.0会将所有以:开头的请求头做一个映射表，然后使用hpack进行压缩，使用这种方式会使请求头更小。</p><p>服务器可主动推送数据给客户端。</p><h4 id="3-1-4-避免重定向">3.1.4 避免重定向</h4><p>301、302 重定向会降低响应速度。</p><h4 id="3-1-5-使用-dns-prefetch">3.1.5 使用 dns-prefetch</h4><p>DNS请求虽然占用的带宽较少，但会有很高的延迟，由其在移动端网络会更加明显。</p><p>使用 dns-prefetch 可以对网站中使用到的域名提前进行解析。提高资源加载速度。</p><p>通过DNS预解析技术可以很好的降低延迟，在访问以图片为主的移动端网站时，使用DNS预解析的情意中下页面加载时间可以减少5%。</p><h4 id="3-1-6-使用域名分片">3.1.6 使用域名分片</h4><p>在HTTP/1.1中，一个域名同时最多创建6个TCP连接，将资源放在多个域名下可提高请求的并发数。</p><h4 id="3-1-7-CDN">3.1.7 CDN</h4><p>静态资源全上CDN，CDN能非常有效的加快网站静态资源的访问速度。</p><h4 id="3-1-8-压缩">3.1.8 压缩</h4><p>gzip压缩、html压缩、js压缩、css压缩、图片压缩。</p><h4 id="3-1-9-使用contenthash">3.1.9 使用contenthash</h4><p>contenthash可以根据文件内容在文件名中加hash，可用于浏览器缓存文件，当文件没有改变时便直接取本地缓存数据。</p><h4 id="3-1-10-合理使用preload、prefetch">3.1.10 合理使用preload、prefetch</h4><figure class="highlight plaintext"><div class="highlight-tools "><i class="fas fa-angle-down expand "></i><div class="code-lang">plaintext</div><div class="copy-notice"></div><i class="fas fa-paste copy-button"></i></div><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel="preload" as="style" href="/static/style.css"&gt;</span><br><span class="line">&lt;link rel="preload" as="font" href="/static/font.woff"&gt;</span><br><span class="line">&lt;link rel="preload" as="script" href="/static/script.js"&gt;</span><br><span class="line"></span><br><span class="line">&lt;link rel="prefetch" as="style" href="/static/style.css"&gt;</span><br><span class="line">&lt;link rel="prefetch" as="font" href="/static/font.woff"&gt;</span><br><span class="line">&lt;link rel="prefetch" as="script" href="/static/script.js"&gt;</span><br></pre></td></tr></tbody></table></figure><p>两者都不会阻塞<code>onload</code>事件，<code>prefetch</code>会在页面空闲时候再进行加载，是提前预加载之后可能要用到的资源，不一定是当前页面使用的，<code>preload</code>预加载的是当前页面的资源。</p><figure class="highlight html"><div class="highlight-tools "><i class="fas fa-angle-down expand "></i><div class="code-lang">html</div><div class="copy-notice"></div><i class="fas fa-paste copy-button"></i></div><div class="code-expand-btn"><i class="fas fa-angle-double-down"></i></div><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"preload"</span> <span class="attr">as</span>=<span class="string">"style"</span> <span class="attr">href</span>=<span class="string">"./preload.css"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">article</span>&gt;</span><span class="tag">&lt;/<span class="name">article</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>如上代码，预加载了css但并没有使用。浏览器在页面<code>onload</code>完成一段时间后，发现还没有引用预加载的资源时，浏览器会在控制台输出下图的提示信息。<br><a target="_blank" rel="noopener" href="https://bu.dusays.com/2022/05/24/628cfd2d0b279.webp" data-fancybox="gallery" data-caption="p13" data-thumb="https://bu.dusays.com/2022/05/24/628cfd2d0b279.webp"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/05/24/628cfd2d0b279.webp" alt="p13"></a></p><p>preload和prefetch可根据资源类型决定资源加载的优先级，详细优先级如代码：</p><figure class="highlight html"><div class="highlight-tools "><i class="fas fa-angle-down expand "></i><div class="code-lang">html</div><div class="copy-notice"></div><i class="fas fa-paste copy-button"></i></div><div class="code-expand-btn"><i class="fas fa-angle-double-down"></i></div><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 最高 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"preload"</span> <span class="attr">as</span>=<span class="string">"style"</span> <span class="attr">href</span>=<span class="string">"./file.xxx"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 高 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"preload"</span> <span class="attr">as</span>=<span class="string">"font"</span> <span class="attr">href</span>=<span class="string">"./file.xxx"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"preload"</span> <span class="attr">as</span>=<span class="string">"fetch"</span> <span class="attr">href</span>=<span class="string">"./file.xxx"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"preload"</span> <span class="attr">as</span>=<span class="string">"script"</span> <span class="attr">href</span>=<span class="string">"./file.xxx"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 低 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"preload"</span> <span class="attr">as</span>=<span class="string">"image"</span> <span class="attr">href</span>=<span class="string">"./file.xxx"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"preload"</span> <span class="attr">as</span>=<span class="string">"track"</span> <span class="attr">href</span>=<span class="string">"./file.xxx"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">article</span>&gt;</span><span class="tag">&lt;/<span class="name">article</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p><a target="_blank" rel="noopener" href="https://bu.dusays.com/2022/05/24/628cfd767a1b3.webp" data-fancybox="gallery" data-caption="p14" data-thumb="https://bu.dusays.com/2022/05/24/628cfd767a1b3.webp"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/05/24/628cfd767a1b3.webp" alt="p14"></a></p><h3 id="3-2-浏览器渲染优化策略">3.2 浏览器渲染优化策略</h3><h4 id="3-2-1-关键渲染路径">3.2.1 关键渲染路径</h4><p>当通过JS或者其他任意方式修改DOM后，浏览器会进入如下流程。</p><p>【JS通过API修改DOM】&gt;【计算样式】&gt;【布局(重排)】&gt;【绘制(重绘)】&gt;【合成】。</p><p><code>Reflow 重排</code>：重排在Chrome Performance中叫做布局，通常添加或删除元素、修改元素大小、移动元素位置、获取位置信息都会触发页面的重排，因为重排可能会改变元素的大小位置等信息，这样的改变会影响到页面大量其它元素的大小位置信息，会耗费掉大量的性能，所以在实际应用中我们应该尽可能的减少重排。</p><p><code>Repaint 重绘</code>：重绘在Chrome Performance中叫做绘制，通常样式改变但没有影响位置时会触发重绘操作，重绘性能还好，但我们也需要尽量减少重绘，如果需要做一些动画，我们尽量使用CSS3动画，CSS3动画只需要在初始化时绘制一次，之后的动画都不会触发重绘操作。</p><h4 id="3-2-2-强制同步布局问题">3.2.2 强制同步布局问题</h4><p>在同一个函数内，修改元素后又获取元素的位置时会触发强制同步布局，影响渲染性能。</p><p>强制同步布局会使js强制将【计算样式】和【布局(重排)】操作提前到当前函数任务中，这样会导致每次运行时执行一次【计算样式】和【重排】，这样一定会影响页面渲染性能，而正常情况下【计算样式】和【重排】操作会在函数结束后统一执行。</p><h4 id="3-2-3-如何减少重排与重绘">3.2.3 如何减少重排与重绘</h4><ol><li>脱离文档流(绝对定位、固定定位)，脱离文档流的元素进行重排不会影响到其他元素。</li><li>图片渲染时增加宽高属性，宽高固定后，图片不会根据内容动态改变高度，便不会触发重排。</li><li>尽量用CSS3动画，CSS3动画能最大程度减少重排与重绘。</li><li>使用will-change: transform;将元素独立为一个单独的图层。（定位、透明、transform、clip都会产生独立图层）。</li></ol><h3 id="3-3-静态文件优化策略">3.3 静态文件优化策略</h3><h4 id="3-3-1-图片优化">3.3.1 图片优化</h4><h5 id="3-3-1-1-图片格式">3.3.1.1 图片格式</h5><ol><li><code>jpg(jpeg)</code>：适合色彩丰富的图、Banner图。不适合：图形文字、图标、不支持透明度。</li><li><code>png</code>：适合纯色、透明、图标，支持纯透明和半透明。不适合色彩丰富图片，因为无损储存会导致储存体积大于jpeg。</li><li><code>gif</code>：适合动画、可以动的图标。支持纯透明但不支持半透明，不适合色彩丰富的图片。埋点信息通常也会使用gif发送，因为1x1的gif图发送的网络请求比普通的get请求要小一些。</li><li><code>webp</code>：支持纯透明和半透明，可以保证图片质量和较小的体积，适合Chrome和移动端浏览器。不适合其他浏览器。</li><li><code>svg</code>：矢量格式，大小非常小，但渲染成本过高，适合小且色彩单一的图标。</li></ol><h5 id="3-3-1-2-优化策略">3.3.1.2 优化策略</h5><ul><li>减少图片资源的尺寸和大小，节约用户流量。</li><li>设置<code>alt=”xxx”</code>属性，图像无法显示时会显示alt内容。</li><li>图片懒加载， <code>loading=”lazy”</code>为原生，建议使用<code>IntersectionObserver</code>自己做懒加载。</li><li>不同环境加载不同尺寸和像素的图片srcset与sizes的使用。</li><li>采用渐进式加载 先加载占位图，然后加载模糊小图，最后加载真正清晰的图。</li><li>使用Base64URL 减少图片请求数。</li><li>采用雪碧图合并图片，减少请求数。</li></ul><h4 id="3-3-2-HTML优化">3.3.2 HTML优化</h4><ul><li>语义化HTML，代码简洁清晰，利于SEO，便于开发维护。</li><li>减少HTML嵌套关系，减少DOM节点数量。</li><li>提前声明字符编码，让浏览器快速确定如何渲染网页内容<code>&lt;html lang="en"&gt; &lt;meta charset="UTF-8"&gt;</code>。</li><li>删除多余空格、空行、注释、无用属性。</li><li>减少iframe，子iframe会阻塞父级的onload事件。可以使用js动态给iframe赋值，就能解决这个问题。</li><li>避免table布局。</li></ul><h4 id="3-3-3-CSS优化">3.3.3 CSS优化</h4><ul><li>减少伪类选择器，减少选择器层数、减少通配符选择器、减少正则选择器。</li><li>避免css表达式<code>background-color: expression(...)</code>。</li><li>删除空格、空行、注释、减少无意义的单位、css压缩。</li><li>css外链，能走缓存。</li><li>添加媒体字段，只加载有效的css文件。</li></ul><figure class="highlight plaintext"><div class="highlight-tools "><i class="fas fa-angle-down expand "></i><div class="code-lang">plaintext</div><div class="copy-notice"></div><i class="fas fa-paste copy-button"></i></div><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel="stylesheet" href="./small.css" media="screen and (max-width:600px)" /&gt;</span><br><span class="line">&lt;link rel="stylesheet" href="./big.css" media="screen and (min-width:601px)"/&gt;</span><br></pre></td></tr></tbody></table></figure><ul><li>使用<code>css contain</code>属性，能控制对应元素是否根据子集元素的改变进行重排。</li><li>减少<code>@import</code>使用，因为它使用串行加载。</li></ul><h4 id="3-3-4-JS优化">3.3.4 JS优化</h4><ul><li>通过script的<code>async</code>、<code>defer</code>属性异步加载，不阻塞DOM渲染。</li><li>减少DOM操作，缓存访问过的元素。</li><li>不直接操作真实DOM，可以先修改，然后一次性应用到DOM上。（虚拟DOM、DOM碎片节点）。</li><li>使用webworker解决复杂运算，避免复杂运算阻塞主线程，webworker线程位于渲染进程。</li><li>图片懒加载，使用<code>IntersectionObserver</code>实现。</li></ul><figure class="highlight html"><div class="highlight-tools "><i class="fas fa-angle-down expand "></i><div class="code-lang">html</div><div class="copy-notice"></div><i class="fas fa-paste copy-button"></i></div><div class="code-expand-btn"><i class="fas fa-angle-double-down"></i></div><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-tag">img</span> {</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">display</span>: block;</span></span><br><span class="line"><span class="language-css">      }</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./loading.gif"</span> <span class="attr">data-src</span>=<span class="string">"./01.jpg"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./loading.gif"</span> <span class="attr">data-src</span>=<span class="string">"./02.jpg"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./loading.gif"</span> <span class="attr">data-src</span>=<span class="string">"./03.jpg"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./loading.gif"</span> <span class="attr">data-src</span>=<span class="string">"./04.jpg"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./loading.gif"</span> <span class="attr">data-src</span>=<span class="string">"./05.jpg"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./loading.gif"</span> <span class="attr">data-src</span>=<span class="string">"./06.jpg"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./loading.gif"</span> <span class="attr">data-src</span>=<span class="string">"./07.jpg"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./loading.gif"</span> <span class="attr">data-src</span>=<span class="string">"./08.jpg"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./loading.gif"</span> <span class="attr">data-src</span>=<span class="string">"./09.jpg"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./loading.gif"</span> <span class="attr">data-src</span>=<span class="string">"./10.jpg"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> intersectionObserver = <span class="keyword">new</span> <span class="title class_">IntersectionObserver</span>(<span class="function">(<span class="params">changes</span>) =&gt;</span> {</span></span><br><span class="line"><span class="language-javascript">        changes.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> {</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (item.<span class="property">intersectionRatio</span> &gt; <span class="number">0</span>) {</span></span><br><span class="line"><span class="language-javascript">            intersectionObserver.<span class="title function_">unobserve</span>(item.<span class="property">target</span>)</span></span><br><span class="line"><span class="language-javascript">            item.<span class="property">target</span>.<span class="property">src</span> = item.<span class="property">target</span>.<span class="property">dataset</span>.<span class="property">src</span></span></span><br><span class="line"><span class="language-javascript">          }</span></span><br><span class="line"><span class="language-javascript">        })</span></span><br><span class="line"><span class="language-javascript">      });</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> domImgList = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">"img"</span>);</span></span><br><span class="line"><span class="language-javascript">      domImgList.<span class="title function_">forEach</span>(<span class="function">(<span class="params">domImg</span>) =&gt;</span> intersectionObserver.<span class="title function_">observe</span>(domImg));</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>虚拟滚动</li><li>使用<code>requestAnimationFrame</code>来做动画，使用<code>requestIdleCallback</code>来进行空闲时的任务处理。</li><li>尽量避免使用eval，性能差。</li><li>使用事件委托，能减少事件绑定个数。事件越多性能越差。</li><li>尽量使用<code>canvas</code>、<code>css3</code>动画。</li><li>通过chrome覆盖率（Coverage）工具排查代码中未使用过的代码并将其删除。</li><li>通过chrome性能（Performance）工具查看每个函数的执行性能并优化。</li></ul><h4 id="3-3-5-字体优化">3.3.5 字体优化</h4><p><code>FOUT</code>(Flash of Unstyled Text）等待一段时间，如果没加载完成，先显示默认。加载 后再进行切换。</p><p><code>FOIT</code>(F1ash of Invisib1e Text） 字体加载完毕后显示，加载超时降级系统字体（白屏）。</p><figure class="highlight html"><div class="highlight-tools "><i class="fas fa-angle-down expand "></i><div class="code-lang">html</div><div class="copy-notice"></div><i class="fas fa-paste copy-button"></i></div><div class="code-expand-btn"><i class="fas fa-angle-double-down"></i></div><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="keyword">@font-face</span> {</span></span><br><span class="line"><span class="language-css">      <span class="attribute">font-family</span>: <span class="string">'hagan'</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">'./font.ttc'</span>);</span></span><br><span class="line"><span class="language-css">      <span class="attribute">font-display</span>: swap;</span></span><br><span class="line"><span class="language-css">      <span class="comment">/* b1ock 35 内不显示，如果没加载完毕用默认的 */</span></span></span><br><span class="line"><span class="language-css">      <span class="comment">/* swap 显示老字体 在替换*/</span></span></span><br><span class="line"><span class="language-css">      <span class="comment">/* fa11back 缩短不显示时间，如果没加载完毕用默认的，和b1ock类似*</span></span></span><br><span class="line"><span class="comment"><span class="language-css">      /* optional 替换可能用字体 可能不替换*/</span></span></span><br><span class="line"><span class="language-css">    }</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">article</span> {</span></span><br><span class="line"><span class="language-css">      <span class="attribute">font-family</span>: hagan;</span></span><br><span class="line"><span class="language-css">    }</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">article</span>&gt;</span>ABC abc<span class="tag">&lt;/<span class="name">article</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="3-4-浏览器储存优化策略">3.4 浏览器储存优化策略</h3><h4 id="3-4-1-Cookie">3.4.1 Cookie</h4><p><code>cookie</code>在过期之前一直有效，最大储存大小为4k，限制字段个数，不适合大量的数据储存，每次请求会携带<code>cookie</code>，主要用来做身份校验。<br>优化方式：</p><ol><li>需要合理设置cookie有效期。</li><li>根据不同子域划分cookie来减少cookie传输。</li><li>静态资源域名和cookie域名采用不同域名，避免静态资源请求携带cookie。</li></ol><h4 id="3-4-2-LocalStorage">3.4.2 LocalStorage</h4><p>Chrome下最多储存5M，除非手动清除，否则一直存在。可以利用<code>localStorage</code>储存静态资源。比如储存网页的<code>.js</code>、<code>.css</code>，这样会使页面打开速度非常快。例如 <a target="_blank" rel="noopener" href="https://m.baidu.com">百度</a></p><figure class="highlight javascript"><div class="highlight-tools "><i class="fas fa-angle-down expand "></i><div class="code-lang">javascript</div><div class="copy-notice"></div><i class="fas fa-paste copy-button"></i></div><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">'hagan'</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showName</span> () {</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(name)</span><br><span class="line">}</span><br><span class="line"><span class="title function_">showName</span>()</span><br></pre></td></tr></tbody></table></figure><figure class="highlight html"><div class="highlight-tools "><i class="fas fa-angle-down expand "></i><div class="code-lang">html</div><div class="copy-notice"></div><i class="fas fa-paste copy-button"></i></div><div class="code-expand-btn"><i class="fas fa-angle-double-down"></i></div><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://lib.baomitu.com/axios/0.26.1/axios.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">cacheFile</span>(<span class="string">'/index.js'</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">cacheFile</span> (url) {</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> fileContent = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(url)</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (fileContent) {</span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">eval</span>(fileContent)</span></span><br><span class="line"><span class="language-javascript">      } <span class="keyword">else</span> {</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> { data } = <span class="keyword">await</span> axios.<span class="title function_">get</span>(url)</span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">eval</span>(data)</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(url, data)</span></span><br><span class="line"><span class="language-javascript">      }</span></span><br><span class="line"><span class="language-javascript">    }</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h4 id="3-4-3-SessionStorage">3.4.3 SessionStorage</h4><p>会话级别储存，可用于页面间的传值。</p><h4 id="3-4-4-IndexDB">3.4.4 IndexDB</h4><p>浏览器的本地数据库，大小几乎无上限。</p><h3 id="3-5-其他优化策略">3.5 其他优化策略</h3><ul><li>关键资源个数越多，首次页面加载时间就会越长。</li><li>关键资源的大小，内容越小下载时间越短。</li><li>优化白屏，合理使用内联css、js。</li><li>预渲染，打包时进行预渲染，生成静态HTML文件，用户访问时直接返回静态HTML。</li><li>服务端渲染同构，加速首屏速度（耗费服务端资源），有利于SEO优化。首屏使用服务端渲染，后续交互使用客户端渲染。</li></ul><h3 id="3-6-使用PWA提高用户体验">3.6 使用PWA提高用户体验</h3><p>webapp用户体验差的一大原因是不能离线访问。用户粘性低的一大原因是无法保存入口，PWA就是为了解决webapp的用户体验问题而诞生的。使用PWA能令站点拥有快速、可靠、安全等特性。</p><ol><li><code>Web App Manifest</code> 将网站添加到电脑桌面、手机桌面，类似Native的体验。</li><li><code>Service Worker</code> 配合<code>Cache API</code>，能做到离线缓存各种内容。</li><li><code>Push API</code> 配合 <code>Notification API</code>，能做到类似Native的消息推送与实时提醒。</li><li><code>App Shell</code> 配合 <code>App Skeleton</code>，能做App壳与骨架屏。</li></ol><h1 id="二、优化小技巧实操">二、优化小技巧实操</h1><h2 id="1-图片压缩">1.图片压缩</h2><h3 id="1-1-图片多级压缩">1.1 图片多级压缩</h3><p>目前从网上下载的图片主流格式是<code>JPG</code>或者<code>PNG</code>，当分辨率比较高的时候体积往往比较大，因此要想提高网站的速度就有必要将图片体积压缩，这里参考店长的推荐，无损压缩推荐<a target="_blank" rel="noopener" href="https://tinypng.com/">Tinypng</a>，有损压缩推荐<a target="_blank" rel="noopener" href="https://github.com/meowtec/Imagine/releases">imagine</a>。</p><table><thead><tr><th style="text-align:left"></th><th style="text-align:center">TinyPNG</th><th>Imagine</th></tr></thead><tbody><tr><td style="text-align:left">特点</td><td style="text-align:center">无损压缩</td><td>有损压缩，以牺牲图像质量， 降低图像色彩来达到缩减图像大小的目的。</td></tr><tr><td style="text-align:left">优点</td><td style="text-align:center">能够完全保留图像色彩，不损伤图像质量</td><td>1. 压缩程度高，支持转<code>png</code>为<code>jpg</code>或<code>webp</code>，进一步减少图片大小 2. 软件支持一次处理多张图片，无上限，处理完成支持直接批量覆盖原文件或重命名</td></tr><tr><td style="text-align:left">缺点</td><td style="text-align:center">单次仅能上传20张图片，每张限制大小为5MB，无法处理更大图片。</td><td>PNG转其他格式为不可逆操作（指覆盖保存后），且可能反而会增加图片大小。</td></tr></tbody></table><p>在这里还给大家推荐一个非常实用的网站：<a target="_blank" rel="noopener" href="https://imagestool.com/zh_CN/index.html">imagesTool</a></p><p><a target="_blank" rel="noopener" href="https://source.fomal.cc/siteshot/imagestool.com.jpg" data-fancybox="gallery" data-caption="" data-thumb="https://source.fomal.cc/siteshot/imagestool.com.jpg"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/siteshot/imagestool.com.jpg" alt=""></a></p><p>这个网站不仅仅支持将<code>PNG</code>与<code>JPG</code>格式的图片批量（完全没有数量限制那种）转化为<code>webp</code>和<code>avif</code>（chrome推荐的一种压缩率更高的编码方式），而且还能改变图片的原始分辨率，甚至将图片压缩到指定的大小，下面演示了一张图压缩之路！</p><a target="_blank" rel="noopener" href="https://s1.vika.cn/space/2022/10/25/c82f67799a524abc8cbaef90b8bf9131" data-fancybox="gallery" data-caption="image-20221025131104569" data-thumb="https://s1.vika.cn/space/2022/10/25/c82f67799a524abc8cbaef90b8bf9131"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s1.vika.cn/space/2022/10/25/c82f67799a524abc8cbaef90b8bf9131" alt="image-20221025131104569" style="zoom:50%"></a><p>我们选择了将<code>PNG</code>转化为<code>webp</code>格式，画质为<code>High</code>，图片规模缩小为<code>80%</code>，压缩率达到94%；而选择将<code>PNG</code>转化为<code>avif</code>格式，画质为<code>High</code>，图片规模缩小为<code>80%</code>，压缩率达到95%，这样下来我们可以把所有图片几乎都可以控制在<code>500KB</code>以下，而且肉眼观察画质没有明显的不同。</p><a target="_blank" rel="noopener" href="https://s1.vika.cn/space/2022/10/25/6e15b7e6ad79406b8320108aaa8e62a9" data-fancybox="gallery" data-caption="image-20221025130942155" data-thumb="https://s1.vika.cn/space/2022/10/25/6e15b7e6ad79406b8320108aaa8e62a9"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s1.vika.cn/space/2022/10/25/6e15b7e6ad79406b8320108aaa8e62a9" alt="image-20221025130942155" style="zoom:67%"></a><div class="note info flat"><p>使用建议:如果没有特别要求，直接使用Imagine进行有损压缩即可。虽然说是有损压缩，但是默认压缩会自主计算压缩程度，一般默认程度就能节省70%空间，且肉眼几乎发现不了图片压缩情况。同时我个人是比较推荐一步到位直接压缩成<code>webp</code>格式，虽然在一些未适配的浏览器（例如IE浏览器）上可能出现无法查看图片的情况，但是压缩率是真的高，图片一路下来压缩个<code>80%</code>毫无压力。如果对图片分辨率要求不太高或者图片分辨率原本就太高了，可以考虑缩小分辨率，结合上面几项，甚至可以压缩<code>90%</code>的大小！</p></div><h3 id="1-2-图片懒加载">1.2 图片懒加载</h3><p>图片懒加载是指只加载目前能看到及其附近的页面上的图片，有节省流量与提高性能的作用。Butterfly主题内置了图片懒加载的选项，在<code>_config.butterfly.yml</code>文件下将对应项设置为如下即可：</p><figure class="highlight yml"><div class="highlight-tools "><i class="fas fa-angle-down expand "></i><div class="code-lang">yml</div><div class="copy-notice"></div><i class="fas fa-paste copy-button"></i></div><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Lazyload (圖片懶加載)</span></span><br><span class="line"><span class="comment"># https://github.com/verlok/vanilla-lazyload</span></span><br><span class="line"><span class="attr">lazyload:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">site</span> <span class="comment"># site/post 选择在哪些地方启用图片懒加载</span></span><br><span class="line">  <span class="attr">placeholder:</span> 	<span class="comment"># 你自己喜欢的图片</span></span><br><span class="line">  <span class="attr">blur:</span> <span class="literal">true</span>	<span class="comment"># 模糊效果</span></span><br></pre></td></tr></tbody></table></figure><h2 id="2-字体二级压缩">2.字体二级压缩</h2><p>我们从网上下载的字体通常都是<code>TTF</code>格式，ttf(TrueTypeFont)是一种字库名称，是Apple公司和Microsoft公司共同推出的字体文件格式，也是最常用的格式之一，但是一些好看的字体往往体积都会很大，网站每次进去都要加载一个这么大的文件，速度肯定会很慢！例如下面这个筑紫A丸2.0的标准体ttf格式的字体文件，体积约为23MB。</p><p><a target="_blank" rel="noopener" href="https://s1.vika.cn/space/2022/10/25/ca08a96314c5429b934b7ef977854650" data-fancybox="gallery" data-caption="image-20221025131822607" data-thumb="https://s1.vika.cn/space/2022/10/25/ca08a96314c5429b934b7ef977854650"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s1.vika.cn/space/2022/10/25/ca08a96314c5429b934b7ef977854650" alt="image-20221025131822607"></a></p><p>这部分参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/littleduo/article/details/124563106">有效的压缩字体方法</a></p><p>一个有效的压缩方法是：<code>fonttools编码压缩+转woff2格式</code>二级压缩</p><h3 id="2-1-使用-fonttools-压缩字体文件">2.1 使用 fonttools 压缩字体文件</h3><p>需要 <code>Python</code> 环境，并已安装好 <code>pip</code>，使用 <code>pip</code> 来安装 <code>fonttools</code></p><figure class="highlight shell"><div class="highlight-tools "><i class="fas fa-angle-down expand "></i><div class="code-lang">shell</div><div class="copy-notice"></div><i class="fas fa-paste copy-button"></i></div><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install fonttools</span><br></pre></td></tr></tbody></table></figure><p>下载已经整理好的字体编码列表文件<code>sc_unicode.txt</code> <a target="_blank" rel="noopener" href="https://gist.githubusercontent.com/imaegoo/d64e5088b723c2e02c40985f55ff12db/raw/5ebd2ce49418c73459a9dfe050483409306a6c1d/sc_unicode.txt">点这里进行下载</a>。</p><p>将你要压缩的字体ttf文件和刚刚下载的sc_unicode.txt编码文件放进去同一个文件夹，进入到该文件夹的控制台如下命令然后回车</p><figure class="highlight shell"><div class="highlight-tools "><i class="fas fa-angle-down expand "></i><div class="code-lang">shell</div><div class="copy-notice"></div><i class="fas fa-paste copy-button"></i></div><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyftsubset ZhuZiAWan-3.ttf --unicodes-file=sc_unicode.txt</span><br></pre></td></tr></tbody></table></figure><p><a target="_blank" rel="noopener" href="https://s1.vika.cn/space/2022/10/25/922e9871848443c1aa79f7ca01c9bfe7" data-fancybox="gallery" data-caption="image-20221025133032806" data-thumb="https://s1.vika.cn/space/2022/10/25/922e9871848443c1aa79f7ca01c9bfe7"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s1.vika.cn/space/2022/10/25/922e9871848443c1aa79f7ca01c9bfe7" alt="image-20221025133032806"></a></p><p><a target="_blank" rel="noopener" href="https://s1.vika.cn/space/2022/10/25/69bee2e71ec24c1eb6c4c9d6dd874f5a" data-fancybox="gallery" data-caption="image-20221025133103786" data-thumb="https://s1.vika.cn/space/2022/10/25/69bee2e71ec24c1eb6c4c9d6dd874f5a"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s1.vika.cn/space/2022/10/25/69bee2e71ec24c1eb6c4c9d6dd874f5a" alt="image-20221025133103786"></a></p><p>然后就会得到图片所示的subset结尾的编码压缩后的ttf文件，体检体积已经从23MB下降到3MB。</p><h3 id="2-2-利用CloudConvert将TTF格式转换成woff2-格式">2.2 利用CloudConvert将<code>TTF</code>格式转换成<code>woff2</code> 格式</h3><p>进去国外平台<a target="_blank" rel="noopener" href="https://cloudconvert.com/">CloudConvert</a>（国内速度可能会慢一些），将TTF格式的字体文件转化为<code>woff2</code>格式</p><p><a target="_blank" rel="noopener" href="https://s1.vika.cn/space/2022/10/25/10aa744585094dbf9914ac029500f51c" data-fancybox="gallery" data-caption="image-20221025133728970" data-thumb="https://s1.vika.cn/space/2022/10/25/10aa744585094dbf9914ac029500f51c"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s1.vika.cn/space/2022/10/25/10aa744585094dbf9914ac029500f51c" alt="image-20221025133728970"></a></p><p>最后压缩成从<code>23MB</code>的文件压缩成<code>1.5MB</code>，足足压缩了十几倍，压缩率十分高！</p><h2 id="3-css和js文件优化">3.css和js文件优化</h2><h3 id="3-1-压缩css与js文件">3.1 压缩css与js文件</h3><ul><li><p>如果是用<code>VSCODE</code>进行网站搭建的小伙伴，可以下载插件<a target="_blank" rel="noopener" href="https://github.com/olback/es6-css-minify/tree/3.0">JS &amp; CSS Minifier (Minify)</a></p></li><li><p>该插件支持将<code>js</code>和<code>css</code>文件的格式进行压缩，降低文件体积</p></li><li><p>使用方法：安装插件后，在<code>js</code>和<code>css</code>文件界面右键，选择<code>Minify Document</code>，插件会生成一个文件名为<code>xxx.min.css</code>或者<code>xxx.min.js</code>的文件，这就是压缩后的文件，在引入的时候直接引用这个压缩后的文件即可。</p></li></ul><a target="_blank" rel="noopener" href="https://s1.vika.cn/space/2022/10/25/1e054153b72f4f429dc3a9a6086ccdb5" data-fancybox="gallery" data-caption="image-20221025134609440" data-thumb="https://s1.vika.cn/space/2022/10/25/1e054153b72f4f429dc3a9a6086ccdb5"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s1.vika.cn/space/2022/10/25/1e054153b72f4f429dc3a9a6086ccdb5" alt="image-20221025134609440" style="zoom:33%"></a><h3 id="3-2-gulp批量压缩">3.2 gulp批量压缩</h3><p>这是压缩全局静态资源的教程，可以参考店长的文章：</p><div class="tag link"><a class="link-card" title="使用gulp压缩博客静态资源" target="_blank" rel="noopener" href="https://akilar.top/posts/49b73b87/"><div class="left"><a target="_blank" rel="noopener" href="https://cdn.cbd.int/akilar-candyassets@1.0.36/image/siteicon/favicon.ico" data-fancybox="gallery" data-caption="" data-thumb="https://cdn.cbd.int/akilar-candyassets@1.0.36/image/siteicon/favicon.ico"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.cbd.int/akilar-candyassets@1.0.36/image/siteicon/favicon.ico"></a></div><div class="right"><p class="text">使用gulp压缩博客静态资源</p><p class="url">https://akilar.top/posts/49b73b87/</p></div></a></div><h3 id="3-3-减少加载项">3.3 减少加载项</h3><p>当网站的东西多起来了之后，会越来越卡顿，这时候推荐以下几个优化方向：</p><ul><li>减少卡片的出场动画<code>wowjs</code>、<code>Live2D</code>、<code>canvas</code>元素等(其中Live2D是比较消耗资源的)</li><li>如果部分js和css文件只有部分页面需要引用，尽量不全局引用，同时删除空格、空行、注释、减少无意义的单位</li><li>css文件尽量添加media字段指定加载设备，js文件的引入可以加入 的 <code>async</code>、<code>defer</code> 属性异步加载，不阻塞 DOM 渲染</li></ul><h2 id="4-无服务器下的资源加速策略">4.无服务器下的资源加速策略</h2><h3 id="4-1-可用的免费CDN选择">4.1 可用的免费CDN选择</h3><p><strong>1.staticaly</strong></p><p>官网地址：<a target="_blank" rel="noopener" href="https://www.staticaly.com">https://www.staticaly.com</a><br>轻松地从GitHub / GitLab / Bitbucket等加载您的项目 没有流量限制或限制。</p><p>文件通过超快速全球CDN提供。 在URL（不是分支）中使用特定标记或提交哈希。<br>根据URL永久缓存文件。 除master分支外，文件在浏览器中缓存1年。 具体用法：</p><figure class="highlight plaintext"><div class="highlight-tools "><i class="fas fa-angle-down expand "></i><div class="code-lang">plaintext</div><div class="copy-notice"></div><i class="fas fa-paste copy-button"></i></div><div class="code-expand-btn"><i class="fas fa-angle-double-down"></i></div><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># GitHub CDN</span><br><span class="line">https://cdn.staticaly.com/gh/:user/:repo/:tag/:file</span><br><span class="line">https://cdn.staticaly.com/gh/growvv/growvv.github.io/master/README.md</span><br><span class="line"></span><br><span class="line"># GitLab CDN</span><br><span class="line">https://cdn.staticaly.com/gl/:user/:repo/:tag/:file</span><br><span class="line"></span><br><span class="line"># Bitbucket CDN</span><br><span class="line">https://cdn.staticaly.com/bb/:user/:repo/:tag/:file</span><br><span class="line"></span><br><span class="line"># WordPress CDN</span><br><span class="line">https://cdn.staticaly.com/wp/c/:version/wp-includes/:file  </span><br><span class="line">https://cdn.staticaly.com/wp/p/:plugin_name/:version/:file  </span><br><span class="line">https://cdn.staticaly.com/wp/t/:theme_name/:version/:file</span><br><span class="line"></span><br><span class="line"># Imgpx CDN</span><br><span class="line">https://cdn.staticaly.com/img/:image_url</span><br><span class="line"></span><br><span class="line"># Favicons CDN</span><br><span class="line">https://cdn.staticaly.com/favicons/:favicon_url</span><br></pre></td></tr></tbody></table></figure><p><strong>2.githack</strong></p><p>直接从GitHub，Bitbucket或GitLab提供原始文件<br>官网地址：<a target="_blank" rel="noopener" href="https://liubing.me/goto/http://raw.githack.com">http://raw.githack.com/</a> 具体用法和上面的<code>staticaly</code>很类似</p><figure class="highlight plaintext"><div class="highlight-tools "><i class="fas fa-angle-down expand "></i><div class="code-lang">plaintext</div><div class="copy-notice"></div><i class="fas fa-paste copy-button"></i></div><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Github CDN</span><br><span class="line">//主分支</span><br><span class="line">https://rawcdn.githack.com/liub1934/LB-Blog/master/wp-content/themes/Memory/emoji/xiaodianshi/baiyan.png</span><br><span class="line"></span><br><span class="line">//版本分支</span><br><span class="line">https://rawcdn.githack.com/liub1934/LB-Blog/8806f440d3f9a7cc3e6125d7d75564e40262c6a8/wp-content/themes/Memory/emoji/xiaodianshi/baiyan.png</span><br></pre></td></tr></tbody></table></figure><p><strong>3.TianliCDN</strong></p><p><a target="_blank" rel="noopener" href="https://tianli-blog.club/jsd/">https://tianli-blog.club/jsd/</a></p><p>轻量级私人CDN，申请见：<a target="_blank" rel="noopener" href="https://tianli-blog.club/jsd/">https://tianli-blog.club/jsd/</a></p><p>4.UNPKG</p><p>见：<a target="_blank" rel="noopener" href="https://unpkg.com/">https://unpkg.com/</a></p><h3 id="4-2-免费图床推荐">4.2 免费图床推荐</h3><ol><li><p>目前我是用的Github公共仓库+Vercel部署加速，速度还可以，关键是支持增量更新和自动部署，不过前期的配置比较麻烦点，你也可以选用Github公共仓库+Cloudflare部署加速，速度和Vercel接近。</p></li><li><p>大概步骤就是建立一个公共仓库，把你本地的图片推上这个仓库，然后将这个仓库部署托管于Vercel，再用一个二级域名绑定这个部署，那就可以通过二级域名+路径的方式访问到图片与资源了。每次仓库更新导致指定分支更新，都会触发Vercel重新部署，实现自动化流程。（这部分教程以后有机会详细写）</p></li><li><p>如果不想折腾或者只想存少量不太重要的图片，那么完全可以用公共的免费图床，下面列举了一些免费的图床：</p><ul><li><p><a target="_blank" rel="noopener" href="https://smms.app/">SMMS</a></p></li><li><p><a target="_blank" rel="noopener" href="https://www.superbed.cn/">聚合图床</a></p></li><li><p><a target="_blank" rel="noopener" href="https://www.hualigs.cn/">遇见图床</a></p></li><li><p><a target="_blank" rel="noopener" href="https://postimages.org/">PostImage</a></p></li><li><p><a target="_blank" rel="noopener" href="https://imgse.com/">路过图床</a></p></li><li><p><a target="_blank" rel="noopener" href="https://www.imgurl.org/">imgURL</a></p></li><li><p><a target="_blank" rel="noopener" href="https://dash.cloudflare.com/">Cloudflare Pages</a></p></li><li><p><a target="_blank" rel="noopener" href="https://imgbox.com/">imgbox</a></p></li><li><p><a target="_blank" rel="noopener" href="https://pic.iqy.ink/upload">Lsky Pro</a></p></li><li><p><a target="_blank" rel="noopener" href="https://upload.cc/">Upload.cc</a></p></li><li><p><a target="_blank" rel="noopener" href="https://imagelol.com/">imagelol</a></p></li></ul></li></ol><h3 id="4-3-域名绑定的好处">4.3 域名绑定的好处</h3><p>目前Vercel的域已经被GFW墙了，如果想用Vercel托管网站又想在国内访问又不想科学上网，只能绑定国内域名，还有想用Vercel来进行资源加速也必须是有国内域名的，同时域名还可以拥有自己的域名邮箱与网站标识符，总之域名还是很有用的。对于静态网站来说你可以没有服务器，但是你不能没有域名。</p><h3 id="4-4-托管平台的选择">4.4 托管平台的选择</h3><p>目前能够托管静态网站的平台有以下几个</p><ol><li><a target="_blank" rel="noopener" href="https://vercel.com/">Vercel</a>（不限量、速度较快） 推荐指数：🌟🌟🌟🌟🌟</li><li><a target="_blank" rel="noopener" href="https://www.cloudflare.com/">Cloudflare</a>（不限量、速度还可以） 推荐指数：🌟🌟🌟🌟</li><li><a target="_blank" rel="noopener" href="https://www.4everland.org/">4EVERLAND</a>（流量限制100GB、速度还可以、适合做备用线路） 推荐指数：🌟🌟🌟</li><li><a target="_blank" rel="noopener" href="https://www.netlify.com/">Netlify</a>（流量限制100GB、速度还可以、适合做备用线路） 推荐指数：🌟🌟🌟</li><li><a target="_blank" rel="noopener" href="https://pages.github.com/">Github Pages</a>（不限量、速度较慢） 推荐指数：🌟🌟</li><li><a target="_blank" rel="noopener" href="https://gitee.com/">Gitee Pages</a>（不限量、速度还可以、但是Gitee与国外平台兼容性差） 推荐指数：🌟🌟</li><li>还有其他的例如<a target="_blank" rel="noopener" href="https://docs.gitlab.com/ee/user/project/pages/">GitLab Pages</a>等就不说了，估计没啥人用</li></ol><h2 id="5-实用工具">5.实用工具</h2><h3 id="5-1-Lighthouse">5.1 Lighthouse</h3><p>Lighthouse 是一个网站性能测评工具， 它是 Google Chrome 推出的一个开源自动化工具，能够对 PWA 和网页多方面的效果指标进行评测，并给出最佳实践的建议以帮助开发者改进网站的质量。它的使用方法也非常简单，我们只需要提供一个要测评的网址，它将针对此页面运行一系列的测试，然后生成一个有关页面性能的报告。通过报告我们就可以知道需要采取哪些措施来改进应用的性能和体验。</p><p>在高版本（应该是 &gt;= 60）的 Chrome 浏览器中，Lighthouse 已经直接集成到了调试工具 DevTools 中了，因此不需要进行任何安装或下载。按 F12 打开开发者工具，可以看到在 console、security 等选项后面有一个 Audits （安装了lighthouse插件或者是高版本的谷歌浏览器可能显示的是 lighthouse）选项，选择该选项，然后点击 generate report 即可。</p><p><a target="_blank" rel="noopener" href="https://s1.vika.cn/space/2022/10/25/d278a76bbd774b1d9912e74aa15b22c5" data-fancybox="gallery" data-caption="image-20221025173341316" data-thumb="https://s1.vika.cn/space/2022/10/25/d278a76bbd774b1d9912e74aa15b22c5"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s1.vika.cn/space/2022/10/25/d278a76bbd774b1d9912e74aa15b22c5" alt="image-20221025173341316"></a></p><p><a target="_blank" rel="noopener" href="https://s1.vika.cn/space/2022/10/25/1d8b86f79de7449782b0c73e897edeb0" data-fancybox="gallery" data-caption="image-20221025173705571" data-thumb="https://s1.vika.cn/space/2022/10/25/1d8b86f79de7449782b0c73e897edeb0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s1.vika.cn/space/2022/10/25/1d8b86f79de7449782b0c73e897edeb0" alt="image-20221025173705571"></a></p><p>使用 Lighthouse 对网站进行测评后，我们会得到一份评分报告，它包含了性能（Performance），访问无障碍（Accessibility），最佳实践（Best Practice），搜索引擎优化（SEO），PWA（Progressive Web App）五个部分：</p><h4 id="5-1-1-性能（Performance）">5.1.1 性能（Performance）</h4><p>性能评分的分值区间是0到100，如果出现0分，通常是在运行 Lighthouse 时发生了错误，满分100分代表了网站已经达到了98分位值的数据，而50分则是75分位值的数据。</p><p>影响评分的性能指标：性能测试结果会分成 Metrics，Diagnostic，Opportunities 三部分，但只有 Metrics 部分的指标项会对分数产生直接影响。</p><p>Lighthouse 会衡量以下 Metrics 性能指标项：</p><ul><li>首次内容绘制（First Contentful Paint）。即浏览器首次将任意内容（如文字、图像、canvas 等）绘制到屏幕上的时间点。</li><li>首次有效绘制（First Meaningful Paint）。衡量了用户感知页面的主要内容（primary content）可见的时间。对于不同的站点，首要内容是不同的，例如：对于博客文章，标题及首屏文字是首要内容，而对于购物网站来说，图片也会变得很重要。</li><li>首次 CPU 空闲（First CPU Idle）。即页面首次能够对输入做出反应的时间点，其出现时机往往在首次有效绘制完成之后。该指标目前仍处于实验阶段。</li><li>可交互时间（Time to Interactive）。指的是所有的页面内容都已经成功加载，且能够快速地对用户的操作做出反应的时间点。该指标目前仍处于实验阶段。</li><li>速度指标（Speed Index）。衡量了首屏可见内容绘制在屏幕上的速度。在首次加载页面的过程中尽量展现更多的内容，往往能给用户带来更好的体验，所以速度指标的值约小越好。</li><li>输入延迟估值（Estimated Input Latency）。这个指标衡量了页面对用户输入行为的反应速度，其基准值应低于 50ms。</li></ul><p>Metrics 部分的指标项会直接影响分数，可以作为我们的主要参考点。</p><p>另外的两部分中， <strong>Opportunities</strong> 指的是优化机会，它提供了详细的建议和文档，来解释低分的原因，帮助我们具体进行实现和改进。<strong>Diagnostics</strong> 指的是现在存在的问题，为进一步改善性能的实验和调整给出了指导。这两者不会纳入分数的计算。</p><p>每一项性能指标对评分的贡献都有其计算逻辑，Lighthouse 会将原始的性能值映射成为 0-100 之间的数字。</p><p>例如，FMP（First Meaningful Paint）的原始值是从页面初始化开始到主要内容渲染成功的耗时，根据真实站点的数据，顶级性能的站点的 FMP 值约为 1220ms，这个值会被映射成 Lighthouse 的 99 分。</p><p>针对不同的评分，Lighthouse 用了不同的颜色进行标注，分值区间和颜色的对应关系如下：</p><ul><li>0 - 49（慢）：红色</li><li>50 - 89（平均值）： 橙色</li><li>90 - 100（快）： 绿色</li></ul><h4 id="5-1-2-访问无障碍（Accessibility）">5.1.2 访问无障碍（Accessibility）</h4><p>访问无障碍评分的分值由相关指标的加权平均值计算而来。可以在<a target="_blank" rel="noopener" href="https://www.cnblogs.com/ypSharing/p/15793767.html#gid=0">评分详情</a>查阅每项指标的具体权重。同理，较大权重的指标项对分数的影响较大。</p><p>无障碍性的每个指标项测试结果为pass或者fail，与性能指标项的计算方式不同，当页面只是部分通过某项指标时，页面的这项指标将不会得分。例如，如果页面中的一些元素有屏幕阅读器友好的命名，而其他的元素没有，那么这个页面的 screenreader-friendly-names 指标项得分为0。</p><h4 id="5-1-3-最佳实践（优化）（Best-Practice）">5.1.3 最佳实践（优化）（Best Practice）</h4><p>最佳实践评分的分数区间为0-100。影响这项评分的指标项的权重都是相同的。</p><p>比如：推荐使用 https，跨域的跳转链接需要使用 rel 标识，不能使用废弃的 API等等。</p><h4 id="5-1-4-搜索引擎优化（SEO）">5.1.4 搜索引擎优化（SEO）</h4><p>比如：图片元素使用 alt 属性等等提高搜索引擎搜索排名，便于搜索引擎能找到你这个网站。</p><h4 id="5-1-5-PWA（Progressive-Web-App）">5.1.5 PWA（Progressive Web App）</h4><p>Lighthouse 使用 PWA 基准检查项列表（Baseline PWA Checklist）进行测评，测评结果将这些指标项分成了四个类别，共包含12个自动测试项和3个手动测试项，其中各个自动测试项的评分权重是相同的。PWA 的评测指标对我们来说非常重要，我们可以从这四个类别详细了解一下基准指标项。</p><ul><li><p><strong>快速可靠：</strong></p><ol><li>页面在移动网络条件下能够快速加载。</li><li>在离线条件下页面能够返回状态码200。这里我们可以通过 Service Worker 来实现离线可用。</li><li>start_url 在离线条件下返回状态码200。start_url 是前面章节我们提到过的 manifest.json 中的一个属性，它指定了用户打开该 PWA 时加载的 URL。</li></ol></li><li><p><strong>可安装：</strong></p><ol><li>始终使用 HTTPS。</li><li>注册 Service Worker 来缓存页面以及 start_url。</li><li>使用 manifest 文件来实现安装 PWA 的需求，浏览器能够主动通知用户将应用添加到桌面，增加留存率。</li></ol></li><li><p><strong>PWA 优化：</strong></p><ol><li>将 HTTP 流量重定向到 HTTPS。</li><li>配置自定义启动画面。</li><li>设置地址栏主题颜色。</li><li>页面内容针对视口大小自适应，对移动用户的展示更友好。</li><li>使用了<meta name="viewport">标签，并设置了 width 或 initial-scale 属性。</li><li>当 JavaScript 文件不可用时，提供降级措施，页面能显示基本内容而不出现白屏。</li></ol></li><li><p><strong>手动测试项：</strong></p><ol><li>站点跨浏览器可用，如主流浏览器 Chrome, Edge, Firefox 及 Safari 等。</li><li>页面间切换流畅，即使在较差的网络环境下，切换动画也应该简洁顺畅，这是提高用户感知体验的关键。</li><li>保证每个页面都有独一无二的 URL，能够在新的浏览器窗口打开，且方便在社交媒体上进行分享。</li></ol></li></ul><p>除了上述基准指标项之外，为了让 PWA 的体验更加完美，还有一些 Lighthouse 未实现检查的进阶指标，也就是可以作为示范性参考的 PWA 的指标，比如用户体验、缓存、推送通知等等。</p><h3 id="5-2-灵雀监控">5.2 灵雀监控</h3><p>灵雀应用监控平台最国内老牌知名免费网站统计51LA网站统计旗下的一个 Web 性能与 bug 监控工具平台，发布后在站长圈内也有一些较好的评价，访问地址：<a target="_blank" rel="noopener" href="https://perf.51.la/">https://perf.51.la</a>。51LA灵雀应用监控平台，专注于帮您及时发现异常问题，帮助运营人员发现网站风险，协助开发者修复网页 bug，从而提升用户体验。产品面向产品，运营以及开发人员作为网站性能及异常信息收集工具。开发人员可以通过页面统计获取用户平均的页面统计信息和网页 Performance 的各个性能指标进行分析，如DNS 解析时间，TTFB、服务器响应时间、白屏时间、页面完全加载时长等是否达标等判断。灵雀应用监控平台为开发人员提供了包含程序异常收集、性能分析、资源异常分析、页面外链跳转分析、可疑脚本/iframe 监控等网站优化和用户体验改进所需的信息。</p><p><strong>特点：</strong></p><ul><li>大家是否有遇到过下面这些情况：</li><li>网站打开速度慢找不到原因；</li><li>部分访客无法打开网站又不能及时得到反馈；</li><li>网站突然无流量或被k 却无从查起起因；</li></ul><p><strong>1.异常分析，精准定位</strong></p><p><a target="_blank" rel="noopener" href="https://s1.vika.cn/space/2022/10/25/2b1d0d3c50394c688f8046819584f7d9" data-fancybox="gallery" data-caption="image-20221025174453208" data-thumb="https://s1.vika.cn/space/2022/10/25/2b1d0d3c50394c688f8046819584f7d9"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s1.vika.cn/space/2022/10/25/2b1d0d3c50394c688f8046819584f7d9" alt="image-20221025174453208"></a></p><p>实时监控网站发生的程序错误、网络请求异常、资源加载异常等潜在问题，精准采集错误上报的页面、错误发生时间、UA等详细的用户设备数据，帮您快速定位异常，提高debug效率。</p><p><strong>2.性能监测，定向优化</strong></p><p><a target="_blank" rel="noopener" href="https://s1.vika.cn/space/2022/10/25/ca16cee5817742389e20d66a9f11df46" data-fancybox="gallery" data-caption="image-20221025174556202" data-thumb="https://s1.vika.cn/space/2022/10/25/ca16cee5817742389e20d66a9f11df46"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s1.vika.cn/space/2022/10/25/ca16cee5817742389e20d66a9f11df46" alt="image-20221025174556202"></a></p><p>采用51LA V6网站统计的多维分析技术，详细展示分析网站性能加载状况，确定网站体验优化方向。</p><p><strong>3.外链监控，规避暗链</strong></p><p><a target="_blank" rel="noopener" href="https://s1.vika.cn/space/2022/10/25/52897c1a5b2042ef8bf27ae299b1ea0c" data-fancybox="gallery" data-caption="image-20221025174628427" data-thumb="https://s1.vika.cn/space/2022/10/25/52897c1a5b2042ef8bf27ae299b1ea0c"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s1.vika.cn/space/2022/10/25/52897c1a5b2042ef8bf27ae299b1ea0c" alt="image-20221025174628427"></a></p><p>提供24小时全方位监控站内外链的功能，定位异常跳转，助您快速识别暗链链接，降低网站被k风险，提升网站安全性。</p></article></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src="/img/woqishanyi.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src="/img/woqishanyi.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">Fomalhaut🥝</div><div class="post-copyright__author_desc">welcome to my blog</div></div><div class="post-copyright__post__info"><a class="post-copyright__reprint" title="该文章为转载文章，注意版权协议" target="_blank" rel="noopener" href="https://www.fomal.cc/posts/b48804d5.html">转载</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://www.fomal.cc/posts/b48804d5.html')">网站性能优化的一些小技巧</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="/img/wechat.png" target="_blank"><img class="post-qr-code-img" src="/img/wechat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/ali.jpg" target="_blank"><img class="post-qr-code-img" src="/img/ali.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div><div class="reward-link mode"><a class="reward-link-button" href="/wechat/"><i class="anzhiyufont anzhiyu-icon-plant-fill"></i>运营模式与责任</a></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://www.fomal.cc/posts/b48804d5.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=网站性能优化的一些小技巧&amp;url=https://www.fomal.cc/posts/b48804d5.html&amp;pic=https://npm.elemecdn.com/ushio-api-img-moe@5.0.42/img_424_1920x1080_72_null_normal.jpg?_r_=f0c0bcf4-503c-3875-0672-a5a58d3318ef" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://XIAO-ZE1.github.io" target="_blank">XIAOZE</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__category-list"><a class="post-meta__box__categoryes" href="/categories/%E6%B1%87%E6%80%BB%E8%AE%B0%E5%BD%95/"><span class="categoryes-punctuation"> <i class="anzhiyufont anzhiyu-icon-inbox"></i></span>汇总记录<span class="categoryesPageCount">16</span></a></div><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/hexo/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>hexo<span class="tagsPageCount">28</span></a><a class="post-meta__box__tags" href="/tags/web/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>web<span class="tagsPageCount">1</span></a></div></div><div class="post_share"><div class="social-share" data-image="https://npm.elemecdn.com/ushio-api-img-moe@5.0.42/img_424_1920x1080_72_null_normal.jpg?_r_=43fd115d-a07e-ba13-2ade-2e4dd6d923b2" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/abb90a24.html"><img class="prev-cover" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/blog-construct/banner.jpg?_r_=fc773971-8570-a289-a43a-e4e7eb600569" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Blog统计界面</div></div></a></div><div class="next-post pull-right"><a href="/posts/aa7b858b.html"><img class="next-cover" src="https://npm.elemecdn.com/ushio-api-img-moe@5.0.42/img_424_1920x1080_72_null_normal.jpg?_r_=43fd115d-a07e-ba13-2ade-2e4dd6d923b2" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">人之一生--人生</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/posts/b2daadad.html" title="Blog搭建基础"><img class="cover" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/blog-construct/banner.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-05</div><div class="title">Blog搭建基础</div></div></a></div><div><a href="/posts/371d898c.html" title="Blog魔改记录"><img class="cover" src="https://npm.elemecdn.com/ushio-api-img-moe@5.0.51/img_518_1920x1080_96_null_normal.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-06</div><div class="title">Blog魔改记录</div></div></a></div><div><a href="/posts/35215.html" title="Blog主页文章卡片擦亮动画效果"><img class="cover" src="https://npm.elemecdn.com/ushio-api-img-moe@5.0.81/img_818_1920x1080_1200_null_normal.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-09</div><div class="title">Blog主页文章卡片擦亮动画效果</div></div></a></div><div><a href="/posts/80632b5b.html" title="Blog待办清单界面"><img class="cover" src="https://cdn.seovx.com/img/mom-19-7%20(211).jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-10</div><div class="title">Blog待办清单界面</div></div></a></div><div><a href="/posts/15b5a328.html" title="Blog宠物挂件"><img class="cover" src="https://cdn.seovx.com/img/mom19-12%20(74).jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-11</div><div class="title">Blog宠物挂件</div></div></a></div><div><a href="/posts/7dfab582.html" title="Blog Page Top Img兼容mp4视频"><img class="cover" src="https://npm.elemecdn.com/ushio-api-img-moe@5.0.86/img_862_1920x1080_96_null_normal.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-12</div><div class="title">Blog Page Top Img兼容mp4视频</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-switch"><span class="first-comment">Twikoo</span><span id="switch-btn"></span><span class="second-comment">Valine</span></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src="/img/woqishanyi.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">软硬件、设计、数码</b>相关的question和opinion，还有<b style="color:#fff">日常</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">内容</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">xiaoze</h1><div class="author-info__desc">welcome to my blog</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/XIAO-ZE1" target="_blank" title="Github"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gitHub"></use></svg></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/492215195" target="_blank" title="BiliBili"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili"></use></svg></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content"><span>👋🏻 Welcome to my blog.希望我的内容对你有帮助.よろしくお願いします！</span><br> <span>❓ 如有问题欢迎评论区交流！</span><br> <span>😫 页面异常？尝试<kbd>Ctrl</kbd>+<kbd>F5</kbd></span><br> <span>📧 如需联系我：<a href="mailto:3337484367@qq.com"><b>发送邮件🚀</b></a></span> <div id="welcome-info"></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="card-widget card-countdown"><div class="item-headline"><i></i><span></span></div><div class="item-content"><div class="cd-count-left">
  <span class="cd-text">距离</span>
  <span class="cd-name" id="eventName"></span>
  <span class="cd-time" id="daysUntil"></span>
  <span class="cd-date" id="eventDate"></span>
</div>
<div id="countRight" class="cd-count-right"></div>
</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E7%90%86%E8%AE%BA%E9%83%A8%E5%88%86"><span class="toc-text">一、理论部分</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86"><span class="toc-text">1.浏览器渲染原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B"><span class="toc-text">1.1 进程与线程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E8%BE%93%E5%85%A5url%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%B1%95%E7%A4%BA%E5%AE%8C%E6%95%B4%E8%BF%87%E7%A8%8B"><span class="toc-text">1.2 输入url到页面展示完整过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5"><span class="toc-text">1.2.1 用户输入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-%E5%8D%B8%E8%BD%BD%E5%8E%9F%E9%A1%B5%E9%9D%A2%E5%B9%B6%E9%87%8D%E5%AE%9A%E5%90%91%E5%88%B0%E6%96%B0%E9%A1%B5%E9%9D%A2"><span class="toc-text">1.2.2 卸载原页面并重定向到新页面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-3-%E5%A4%84%E7%90%86Service-Worker"><span class="toc-text">1.2.3 处理Service Worker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-4-%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82"><span class="toc-text">1.2.4 网络请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-5-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%93%8D%E5%BA%94"><span class="toc-text">1.2.5 服务端响应</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-6-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E8%AF%A6%E7%BB%86%E6%B5%81%E7%A8%8B"><span class="toc-text">1.2.6 浏览器渲染详细流程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%A4%84%E7%90%86%E6%AF%8F%E4%B8%80%E5%B8%A7%E7%9A%84%E6%B5%81%E7%A8%8B"><span class="toc-text">1.3 浏览器处理每一帧的流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Chrome%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7"><span class="toc-text">2.Chrome性能优化相关工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-Chrome-Performance-%E6%80%A7%E8%83%BD"><span class="toc-text">2.1 Chrome Performance(性能)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-Chrome-Performance-%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">2.1.1 Chrome Performance 工具的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-%E4%BD%BF%E7%94%A8Performance-API%E8%8E%B7%E5%8F%96%E6%80%A7%E8%83%BD%E7%9B%B8%E5%85%B3%E6%8C%87%E6%A0%87"><span class="toc-text">2.1.2 使用Performance API获取性能相关指标</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-Coverage-%E8%A6%86%E7%9B%96%E7%8E%87"><span class="toc-text">2.2 Coverage(覆盖率)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-Lighthouse"><span class="toc-text">2.3 Lighthouse</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-Network-%E7%BD%91%E7%BB%9C"><span class="toc-text">2.4 Network(网络)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-1-%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E4%B8%AD%E7%9A%84Timing-%E6%97%B6%E9%97%B4"><span class="toc-text">2.4.1 网络请求中的Timing(时间)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-2-%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-text">2.4.2 网络请求的优先级</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-3-%E7%BD%91%E9%A1%B5%E6%80%BB%E8%B5%84%E6%BA%90%E4%BF%A1%E6%81%AF"><span class="toc-text">2.4.3 网页总资源信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-4-Network%E9%85%8D%E7%BD%AE"><span class="toc-text">2.4.4 Network配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%BD%91%E9%A1%B5%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-text">3.网页性能优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="toc-text">3.1 网络优化策略</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1-%E5%87%8F%E5%B0%91HTTP%E8%AF%B7%E6%B1%82%E6%95%B0"><span class="toc-text">3.1.1 减少HTTP请求数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-%E4%BD%BF%E7%94%A8HTTP%E7%BC%93%E5%AD%98"><span class="toc-text">3.1.2 使用HTTP缓存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-3-%E4%BD%BF%E7%94%A8-HTTP-2-0"><span class="toc-text">3.1.3 使用 HTTP&#x2F;2.0</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-4-%E9%81%BF%E5%85%8D%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-text">3.1.4 避免重定向</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-5-%E4%BD%BF%E7%94%A8-dns-prefetch"><span class="toc-text">3.1.5 使用 dns-prefetch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-6-%E4%BD%BF%E7%94%A8%E5%9F%9F%E5%90%8D%E5%88%86%E7%89%87"><span class="toc-text">3.1.6 使用域名分片</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-7-CDN"><span class="toc-text">3.1.7 CDN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-8-%E5%8E%8B%E7%BC%A9"><span class="toc-text">3.1.8 压缩</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-9-%E4%BD%BF%E7%94%A8contenthash"><span class="toc-text">3.1.9 使用contenthash</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-10-%E5%90%88%E7%90%86%E4%BD%BF%E7%94%A8preload%E3%80%81prefetch"><span class="toc-text">3.1.10 合理使用preload、prefetch</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="toc-text">3.2 浏览器渲染优化策略</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-%E5%85%B3%E9%94%AE%E6%B8%B2%E6%9F%93%E8%B7%AF%E5%BE%84"><span class="toc-text">3.2.1 关键渲染路径</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-%E5%BC%BA%E5%88%B6%E5%90%8C%E6%AD%A5%E5%B8%83%E5%B1%80%E9%97%AE%E9%A2%98"><span class="toc-text">3.2.2 强制同步布局问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-%E5%A6%82%E4%BD%95%E5%87%8F%E5%B0%91%E9%87%8D%E6%8E%92%E4%B8%8E%E9%87%8D%E7%BB%98"><span class="toc-text">3.2.3 如何减少重排与重绘</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="toc-text">3.3 静态文件优化策略</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-1-%E5%9B%BE%E7%89%87%E4%BC%98%E5%8C%96"><span class="toc-text">3.3.1 图片优化</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-1-1-%E5%9B%BE%E7%89%87%E6%A0%BC%E5%BC%8F"><span class="toc-text">3.3.1.1 图片格式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-1-2-%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="toc-text">3.3.1.2 优化策略</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-2-HTML%E4%BC%98%E5%8C%96"><span class="toc-text">3.3.2 HTML优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-3-CSS%E4%BC%98%E5%8C%96"><span class="toc-text">3.3.3 CSS优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-4-JS%E4%BC%98%E5%8C%96"><span class="toc-text">3.3.4 JS优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-5-%E5%AD%97%E4%BD%93%E4%BC%98%E5%8C%96"><span class="toc-text">3.3.5 字体优化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%82%A8%E5%AD%98%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="toc-text">3.4 浏览器储存优化策略</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-1-Cookie"><span class="toc-text">3.4.1 Cookie</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-2-LocalStorage"><span class="toc-text">3.4.2 LocalStorage</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-3-SessionStorage"><span class="toc-text">3.4.3 SessionStorage</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-4-IndexDB"><span class="toc-text">3.4.4 IndexDB</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-%E5%85%B6%E4%BB%96%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="toc-text">3.5 其他优化策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-%E4%BD%BF%E7%94%A8PWA%E6%8F%90%E9%AB%98%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C"><span class="toc-text">3.6 使用PWA提高用户体验</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E4%BC%98%E5%8C%96%E5%B0%8F%E6%8A%80%E5%B7%A7%E5%AE%9E%E6%93%8D"><span class="toc-text">二、优化小技巧实操</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9"><span class="toc-text">1.图片压缩</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%9B%BE%E7%89%87%E5%A4%9A%E7%BA%A7%E5%8E%8B%E7%BC%A9"><span class="toc-text">1.1 图片多级压缩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%9B%BE%E7%89%87%E6%87%92%E5%8A%A0%E8%BD%BD"><span class="toc-text">1.2 图片懒加载</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%AD%97%E4%BD%93%E4%BA%8C%E7%BA%A7%E5%8E%8B%E7%BC%A9"><span class="toc-text">2.字体二级压缩</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E4%BD%BF%E7%94%A8-fonttools-%E5%8E%8B%E7%BC%A9%E5%AD%97%E4%BD%93%E6%96%87%E4%BB%B6"><span class="toc-text">2.1 使用 fonttools 压缩字体文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%88%A9%E7%94%A8CloudConvert%E5%B0%86TTF%E6%A0%BC%E5%BC%8F%E8%BD%AC%E6%8D%A2%E6%88%90woff2-%E6%A0%BC%E5%BC%8F"><span class="toc-text">2.2 利用CloudConvert将TTF格式转换成woff2 格式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-css%E5%92%8Cjs%E6%96%87%E4%BB%B6%E4%BC%98%E5%8C%96"><span class="toc-text">3.css和js文件优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%8E%8B%E7%BC%A9css%E4%B8%8Ejs%E6%96%87%E4%BB%B6"><span class="toc-text">3.1 压缩css与js文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-gulp%E6%89%B9%E9%87%8F%E5%8E%8B%E7%BC%A9"><span class="toc-text">3.2 gulp批量压缩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E5%87%8F%E5%B0%91%E5%8A%A0%E8%BD%BD%E9%A1%B9"><span class="toc-text">3.3 减少加载项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%97%A0%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8B%E7%9A%84%E8%B5%84%E6%BA%90%E5%8A%A0%E9%80%9F%E7%AD%96%E7%95%A5"><span class="toc-text">4.无服务器下的资源加速策略</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%8F%AF%E7%94%A8%E7%9A%84%E5%85%8D%E8%B4%B9CDN%E9%80%89%E6%8B%A9"><span class="toc-text">4.1 可用的免费CDN选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E6%8E%A8%E8%8D%90"><span class="toc-text">4.2 免费图床推荐</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E5%9F%9F%E5%90%8D%E7%BB%91%E5%AE%9A%E7%9A%84%E5%A5%BD%E5%A4%84"><span class="toc-text">4.3 域名绑定的好处</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E6%89%98%E7%AE%A1%E5%B9%B3%E5%8F%B0%E7%9A%84%E9%80%89%E6%8B%A9"><span class="toc-text">4.4 托管平台的选择</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="toc-text">5.实用工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-Lighthouse"><span class="toc-text">5.1 Lighthouse</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-1-%E6%80%A7%E8%83%BD%EF%BC%88Performance%EF%BC%89"><span class="toc-text">5.1.1 性能（Performance）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-2-%E8%AE%BF%E9%97%AE%E6%97%A0%E9%9A%9C%E7%A2%8D%EF%BC%88Accessibility%EF%BC%89"><span class="toc-text">5.1.2 访问无障碍（Accessibility）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-3-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BC%98%E5%8C%96%EF%BC%89%EF%BC%88Best-Practice%EF%BC%89"><span class="toc-text">5.1.3 最佳实践（优化）（Best Practice）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-4-%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E4%BC%98%E5%8C%96%EF%BC%88SEO%EF%BC%89"><span class="toc-text">5.1.4 搜索引擎优化（SEO）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-5-PWA%EF%BC%88Progressive-Web-App%EF%BC%89"><span class="toc-text">5.1.5 PWA（Progressive Web App）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E7%81%B5%E9%9B%80%E7%9B%91%E6%8E%A7"><span class="toc-text">5.2 灵雀监控</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/aa7b858b.html" title="人之一生--人生"><img src="https://npm.elemecdn.com/ushio-api-img-moe@5.0.42/img_424_1920x1080_72_null_normal.jpg?_r_=43fd115d-a07e-ba13-2ade-2e4dd6d923b2" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="人之一生--人生"/></a><div class="content"><a class="title" href="/posts/aa7b858b.html" title="人之一生--人生">人之一生--人生</a><time datetime="2025-02-12T05:53:54.000Z" title="发表于 2025-02-12 13:53:54">2025-02-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/b48804d5.html" title="网站性能优化的一些小技巧"><img src="https://npm.elemecdn.com/ushio-api-img-moe@5.0.42/img_424_1920x1080_72_null_normal.jpg?_r_=f0c0bcf4-503c-3875-0672-a5a58d3318ef" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="网站性能优化的一些小技巧"/></a><div class="content"><a class="title" href="/posts/b48804d5.html" title="网站性能优化的一些小技巧">网站性能优化的一些小技巧</a><time datetime="2025-02-10T13:59:03.000Z" title="发表于 2025-02-10 21:59:03">2025-02-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/abb90a24.html" title="Blog统计界面"><img src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/blog-construct/banner.jpg?_r_=fc773971-8570-a289-a43a-e4e7eb600569" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Blog统计界面"/></a><div class="content"><a class="title" href="/posts/abb90a24.html" title="Blog统计界面">Blog统计界面</a><time datetime="2025-02-10T02:57:12.000Z" title="发表于 2025-02-10 10:57:12">2025-02-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/812d49a5.html" title="科学上网"><img src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/blog-construct/banner.jpg?_r_=fae960c1-8c04-87d5-f225-6d9f6ecd43b0" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="科学上网"/></a><div class="content"><a class="title" href="/posts/812d49a5.html" title="科学上网">科学上网</a><time datetime="2025-02-09T16:21:17.000Z" title="发表于 2025-02-10 00:21:17">2025-02-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/fb119535.html" title="Blog侧边栏steam卡片"><img src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/blog-construct/banner.jpg?_r_=85aef461-b011-b42a-1a95-b7b6bf4936b8" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Blog侧边栏steam卡片"/></a><div class="content"><a class="title" href="/posts/fb119535.html" title="Blog侧边栏steam卡片">Blog侧边栏steam卡片</a><time datetime="2025-02-09T16:02:17.000Z" title="发表于 2025-02-10 00:02:17">2025-02-10</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="mailto:3337484367@qq.com" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0, 500)" src="/img/woqishanyi.jpg" size="50px"/><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/XIAO-ZE1" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://space.bilibili.com/492215195" title="Bilibili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div><div id="workboard"><img class="workSituationImg boardsign" src="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-上班摸鱼中.svg" alt="距离成功上岸还差一万步~" title="距离成功上岸还差一万步~"/><div id="runtimeTextTip"></div></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="51la统计" target="_blank" rel="noopener" href="https://v6.51.la/">51la统计</a><a class="footer-item" title="十年之约" target="_blank" rel="noopener" href="https://www.foreverblog.cn/">十年之约</a><a class="footer-item" title="开往" target="_blank" rel="noopener" href="https://github.com/travellings-link/travellings">开往</a></div></div><div class="footer-group"><div class="footer-title">主题</div><div class="footer-links"><a class="footer-item" title="文档" href="/archives/">文档</a><a class="footer-item" title="主题源码" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu">主题源码</a><a class="footer-item" title="更新日志" href="/update/">更新日志</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="即刻短文" href="/essay/">即刻短文</a><a class="footer-item" title="友链文章" href="/fcircle/">友链文章</a><a class="footer-item" title="留言板" href="/comments/">留言板</a></div></div><div class="footer-group"><div class="footer-title">协议</div><div class="footer-links"><a class="footer-item" title="隐私协议" href="/privacy/">隐私协议</a><a class="footer-item" title="Cookies" href="/cookies/">Cookies</a><a class="footer-item" title="版权协议" href="/protocol/">版权协议</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v7.3.0" title="博客框架为Hexo_v7.3.0"><img src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v7.3.0"/></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2025 By <a class="footer-bar-link" href="/" title="xiaoze" target="_blank">xiaoze</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  getScript('https://sdk.jinrishici.com/v2/browser/jinrishici.js').then(() => {
    jinrishici.load(result =>{
      if (true) {
        const sub = ["纵有疾风起，人生不言弃！","要有风，要有肉；要有绩点，要有酒；要有美女，要有驴！"]
        const content = result.data.content
        sub.unshift(content)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = result.data.content
      }
    })
  })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://unpkg.com/typed.js@2.0.16/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://image.anheyu.com" title="图床">图床</a><a class="footer-bar-link cc" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" title="cc协议"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-by-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nc-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nd-line"></i></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">36</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">10</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">3</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">趣味</div><div class="back-menu-list"><a class="back-menu-item" href="/beauty/" title="养眼视频"><img class="back-menu-item-icon" src="/img/mobile1.png" alt="养眼视频"/><span class="back-menu-item-text">养眼视频</span></a><a class="back-menu-item" href="/air-conditioner/" title="小空调"><img class="back-menu-item-icon" src="/img/mobile2.png" alt="小空调"/><span class="back-menu-item-text">小空调</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">图片</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://haowallpaper.com/homeView" title="哲风壁纸"><img class="back-menu-item-icon" src="/img/mobile3.png" alt="哲风壁纸"/><span class="back-menu-item-text">哲风壁纸</span></a><a class="back-menu-item" href="/picture/" title="随机壁纸"><img class="back-menu-item-icon" src="/img/pc2.png" alt="随机壁纸"/><span class="back-menu-item-text">随机壁纸</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">anzhiyu</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://index.anheyu.com/" title="个人主页"><img class="back-menu-item-icon" src="https://bu.dusays.com/2023/08/13/64d8c2748ef34.jpg" alt="个人主页"/><span class="back-menu-item-text">个人主页</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src="https://bu.dusays.com/2023/07/23/64bc72c75319d.png" alt="博客"/><span class="back-menu-item-text">博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="图床"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="图床"/><span class="back-menu-item-text">图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="anzhiyufont anzhiyu-icon-zonglan faa-tada" style="font-size: 0.9em;"></i><span> 统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/update/"><i class="anzhiyufont anzhiyu-icon-history faa-tada" style="font-size: 0.9em;"></i><span> 本站日志</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?id=2963512140&amp;server=tencent"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/cinemas/"><i class="anzhiyufont anzhiyu-icon-fw-eye faa-tada" style="font-size: 0.9em;"></i><span> 追剧页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 我的装备</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/games/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-game"></use></svg><span> 游戏人生</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/todolist/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> TODOlist</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/diary/"><i class="anzhiyufont anzhiyu-icon-book faa-tada" style="font-size: 0.9em;"></i><span> 日记</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 功能</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/beauty/"><i class="anzhiyufont anzhiyu-icon-heartbeat faa-tada" style="font-size: 0.9em;"></i><span> 养眼</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/picture/"><i class="anzhiyufont anzhiyu-icon-heartbeat faa-tada" style="font-size: 0.9em;"></i><span> 壁纸</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CDN/" style="font-size: 0.88rem; color: rgb(81, 94, 178);">CDN<sup>1</sup></a><a href="/tags/Git/" style="font-size: 0.88rem; color: rgb(133, 6, 64);">Git<sup>1</sup></a><a href="/tags/Markdown/" style="font-size: 0.88rem; color: rgb(29, 58, 68);">Markdown<sup>1</sup></a><a href="/tags/hexo/" style="font-size: 0.88rem; color: rgb(106, 170, 170);">hexo<sup>28</sup></a><a href="/tags/test/" style="font-size: 0.88rem; color: rgb(88, 90, 40);">test<sup>1</sup></a><a href="/tags/web/" style="font-size: 0.88rem; color: rgb(74, 162, 143);">web<sup>1</sup></a><a href="/tags/%E5%A4%96%E6%8C%82%E6%A0%87%E7%AD%BE/" style="font-size: 0.88rem; color: rgb(87, 73, 21);">外挂标签<sup>1</sup></a><a href="/tags/%E5%A4%A7%E5%AD%A6/" style="font-size: 0.88rem; color: rgb(91, 49, 35);">大学<sup>2</sup></a><a href="/tags/%E9%AD%94%E6%94%B9/" style="font-size: 0.88rem; color: rgb(48, 183, 130);">魔改<sup>17</sup></a><a href="/tags/%E9%AD%94%E6%B3%95/" style="font-size: 0.88rem; color: rgb(115, 137, 189);">魔法<sup>1</sup></a></div></div><hr/></div></div><div id="keyboard-tips"><div class="keyboardTitle">博客快捷键</div><div class="keybordList"><div class="keybordItem"><div class="keyGroup"><div class="key">shift K</div></div><div class="keyContent"><div class="content">关闭快捷键功能</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift A</div></div><div class="keyContent"><div class="content">打开/关闭中控台</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift M</div></div><div class="keyContent"><div class="content">播放/暂停音乐</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift D</div></div><div class="keyContent"><div class="content">深色/浅色显示模式</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift S</div></div><div class="keyContent"><div class="content">站内搜索</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift R</div></div><div class="keyContent"><div class="content">随机访问</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift H</div></div><div class="keyContent"><div class="content">返回首页</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift F</div></div><div class="keyContent"><div class="content">友链鱼塘</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift L</div></div><div class="keyContent"><div class="content">友链页面</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift P</div></div><div class="keyContent"><div class="content">关于本站</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift I</div></div><div class="keyContent"><div class="content">原版/本站右键菜单</div></div></div></div></div><div id="rightside"><div id="rightside-config-hide"><button class="share" type="button" title="右键模式" onclick="changeMouseMode()"><i class="fas fa-mouse"></i></button><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button><button id="refresh-cache" type="button" title="刷新缓存" onclick="refreshCache()"><i class="fas fa-refresh fa-spin"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas anzhiyufont anzhiyu-icon-gear fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="chat-btn" type="button" title="聊天"><i class="anzhiyufont anzhiyu-icon-comment-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="anzhiyu.scrollToDest(document.body.scrollHeight, 500)"><i class="anzhiyufont anzhiyu-icon-arrow-down"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="2963512140" server="tencent" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/2963512140&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="app-refresh" id="app-refresh" style="position: fixed;top: -2.2rem;left: 0;right: 0;z-index: 99999;padding: 0 1rem;font-size: 15px;height: 2.2rem;transition: all 0.3s ease;"><div class="app-refresh-wrap" style=" display: flex;color: #fff;height: 100%;align-items: center;justify-content: center;"><label>✨ 有新文章啦！ 👉</label><a href="javascript:void(0)" onclick="location.reload()"><span style="color: #fff;text-decoration: underline;cursor: pointer;">🍗点击食用🍔</span></a></div></div><script>if ('serviceWorker' in navigator) {
if (navigator.serviceWorker.controller) {
navigator.serviceWorker.addEventListener('controllerchange', function() {
showNotification()
})
}
window.addEventListener('load', function() {
navigator.serviceWorker.register('/sw.js')
})
}
function showNotification() {
if (GLOBAL_CONFIG.Snackbar) {
var snackbarBg =
document.documentElement.getAttribute('data-theme') === 'light' ?
GLOBAL_CONFIG.Snackbar.bgLight :
GLOBAL_CONFIG.Snackbar.bgDark
var snackbarPos = GLOBAL_CONFIG.Snackbar.position
Snackbar.show({
text: '✨ 有新文章啦！ 👉',
backgroundColor: snackbarBg,
duration: 500000,
pos: snackbarPos,
actionText: '🍗点击食用🍔',
actionTextColor: '#fff',
onActionClick: function(e) {
location.reload()
},
})
} else {
var showBg =
document.documentElement.getAttribute('data-theme') === 'light' ?
'#3b70fc' :
'#1f1f1f'
var cssText = `top: 0; background: ${showBg};`
document.getElementById('app-refresh').style.cssText = cssText
}
}</script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("01/01/2025 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用xiaoze!`,
    `纵有疾风起，人生不言弃`,
    `
        ██╗  ██╗██╗ █████╗  ██████╗ ███████╗███████╗
        ╚██╗██╔╝██║██╔══██╗██╔═══██╗╚══███╔╝██╔════╝
         ╚███╔╝ ██║███████║██║   ██║  ███╔╝ █████╗  
         ██╔██╗ ██║██╔══██║██║   ██║ ███╔╝  ██╔══╝  
        ██╔╝ ██╗██║██║  ██║╚██████╔╝███████╗███████╗
        ╚═╝  ╚═╝╚═╝╚═╝  ╚═╝ ╚═════╝ ╚══════╝╚══════╝
                                          
        `,
    "已上线",
    dnum,
    "天",
    "©2025 By xiaoze V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小添柴】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小添柴.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by xiaoze %c 你正在访问 xiaoze 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/xiaoze/random.js"></script><script async="async">(function () {
  var grt = new Date("01/01/2025 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-下班啦.svg";
        img.title = "该学学，该卷卷~";
        img.alt = "该学学，该卷卷~";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.cbd.int/mermaid@10.2.4/dist/mermaid.min.js').then(runMermaid)
  }

  anzhiyu.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo-mjza-ih4k7fwdq-xiaozes-projects-7ca5bf96.vercel.app/',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo-mjza-ih4k7fwdq-xiaozes-projects-7ca5bf96.vercel.app/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'WWNV6msGafgW2ua4kXQ1wR6q-gzGzoHsz',
      appKey: 'sPZQBANP6PE553SfsWNj8Tej',
      avatar: 'mp',
      serverURLs: '',
      emojiMaps: {"0":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/0.gif","1":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/1.gif","2":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/2.gif","3":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/3.gif","4":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/4.gif","5":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/5.gif","6":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/6.gif","7":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/7.gif","8":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/8.gif","9":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/9.gif","10":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/10.gif","11":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/11.gif","12":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/12.gif","13":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/13.gif","14":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/14.gif","15":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/15.gif","16":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/16.gif","17":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/17.gif","18":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/18.gif","19":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/19.gif","20":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/20.gif","21":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/21.gif","22":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/22.gif","23":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/23.gif","24":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/24.gif","25":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/25.gif","26":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/26.gif","27":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/27.gif","28":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/28.gif","29":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/29.gif","30":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/30.gif","31":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/31.gif","32":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/32.gif","33":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/33.gif","34":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/34.gif","35":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/35.gif","36":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/36.gif","37":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/37.gif","38":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/38.gif","39":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/39.gif","40":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/40.gif","41":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/41.gif","42":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/42.gif","43":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/43.gif","44":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/44.gif","45":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/45.gif","46":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/46.gif","47":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/47.gif","48":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/48.gif","49":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/49.gif","50":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/50.gif","51":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/51.gif","52":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/52.gif","53":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/53.gif","54":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/54.gif","55":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/55.gif","56":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/56.gif","57":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/57.gif","58":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/58.gif","59":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/59.gif","60":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/60.gif","61":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/61.gif","62":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/62.gif","63":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/63.gif","64":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/64.gif","65":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/65.gif","66":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/66.gif","67":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/67.gif","68":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/68.gif","69":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/69.gif","70":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/70.gif","71":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/71.gif","72":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/72.gif","73":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/73.gif","74":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/74.gif","75":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/75.gif","76":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/76.gif","77":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/77.gif","78":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/78.gif","79":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/79.gif","80":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/80.gif","81":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/81.gif","82":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/82.gif","83":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/83.gif","84":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/84.gif","85":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/85.gif","86":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/86.gif","87":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/87.gif","88":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/88.gif","89":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/89.gif","90":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/90.gif","91":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/91.gif","92":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/92.gif","93":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/93.gif","94":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/94.gif","95":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/95.gif","96":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/96.gif","97":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/97.gif","98":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/98.gif","99":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/99.gif","100":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/100.gif","101":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/101.gif","102":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/102.gif","103":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/103.gif","104":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/104.gif","105":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/105.gif","106":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/106.gif","107":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/107.gif","108":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/108.gif","109":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/109.gif","110":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/110.gif","111":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/111.gif","112":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/112.gif","113":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/113.gif","114":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/114.gif","115":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/115.gif","116":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/116.gif","117":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/117.gif","118":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/118.gif","119":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/119.gif","120":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/120.gif","121":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/121.gif","122":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/122.gif","123":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/123.gif","124":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/124.gif","125":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/125.gif","126":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/126.gif","127":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/127.gif","128":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/128.gif","129":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/129.gif","130":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/130.gif","131":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/131.gif","132":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/132.gif","133":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/133.gif","134":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/134.gif","135":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/135.gif","136":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/136.gif","137":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/137.gif","138":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/138.gif","139":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/139.gif","140":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/140.gif","141":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/141.gif","142":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/142.gif","143":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/143.gif","144":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/144.gif","145":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/145.gif","146":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/146.gif","147":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/147.gif","148":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/148.gif","149":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/149.gif","150":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/150.gif","151":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/151.gif","152":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/152.gif","153":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/153.gif","154":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/154.gif","155":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/155.gif","156":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/156.gif","157":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/157.gif","158":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/158.gif","159":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/159.gif","160":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/160.gif","161":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/161.gif","162":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/162.gif","163":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/163.gif","164":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/164.gif","165":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/165.gif","166":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/166.gif","167":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/167.gif","168":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/168.gif","169":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/169.gif","170":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/170.gif","171":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/171.gif","172":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/172.gif","173":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/173.gif","174":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/174.gif","175":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/175.gif","176":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/176.gif","177":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/177.gif","178":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/178.gif","179":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/179.gif","180":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/180.gif","181":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/181.gif","182":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/182.gif","183":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/183.gif","184":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/184.gif","185":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/185.gif","186":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/186.gif","187":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/187.gif","188":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/188.gif","189":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/189.gif","190":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/190.gif","191":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/191.gif","192":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/192.gif","193":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/193.gif","194":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/194.gif","195":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/195.gif","196":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/196.gif","197":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/197.gif","198":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/198.gif","199":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/199.gif","200":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/200.gif","201":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/201.gif","202":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/202.gif","203":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/203.gif","204":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/204.gif","205":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/205.gif","206":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/206.gif","207":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/qq_2020f/207.gif","bili_tv_gif_黑人问号":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/黑人问号.gif","bili_tv_gif_抓狂":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/抓狂.gif","bili_tv_gif_再见":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/再见.gif","bili_tv_gif_晕":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/晕.gif","bili_tv_gif_疑问":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/疑问.gif","bili_tv_gif_斜眼笑":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/斜眼笑.gif","bili_tv_gif_笑哭":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/笑哭.gif","bili_tv_gif_无奈":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/无奈.gif","bili_tv_gif_委屈":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/委屈.gif","bili_tv_gif_微笑":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/微笑.gif","bili_tv_gif_吐血":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/吐血.gif","bili_tv_gif_偷笑":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/偷笑.gif","bili_tv_gif_思考":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/思考.gif","bili_tv_gif_睡着":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/睡着.gif","bili_tv_gif_生气":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/生气.gif","bili_tv_gif_生病":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/生病.gif","bili_tv_gif_色":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/色.gif","bili_tv_gif_亲亲":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/亲亲.gif","bili_tv_gif_呕吐":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/呕吐.gif","bili_tv_gif_难过":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/难过.gif","bili_tv_gif_腼腆":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/腼腆.gif","bili_tv_gif_流汗":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/流汗.gif","bili_tv_gif_流鼻血":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/流鼻血.gif","bili_tv_gif_困":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/困.gif","bili_tv_gif_抠鼻子":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/抠鼻子.gif","bili_tv_gif_可爱":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/可爱.gif","bili_tv_gif_惊吓":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/惊吓.gif","bili_tv_gif_坏笑":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/坏笑.gif","bili_tv_gif_害羞":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/害羞.gif","bili_tv_gif_鼓掌":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/鼓掌.gif","bili_tv_gif_尴尬":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/尴尬.gif","bili_tv_gif_发怒":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/发怒.gif","bili_tv_gif_发财":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/发财.gif","bili_tv_gif_调皮":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/调皮.gif","bili_tv_gif_点赞":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/点赞.gif","bili_tv_gif_呆":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/呆.gif","bili_tv_gif_大佬":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/大佬.gif","bili_tv_gif_大哭":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/大哭.gif","bili_tv_gif_打脸":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/打脸.gif","bili_tv_gif_馋":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/馋.gif","bili_tv_gif_闭嘴":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/闭嘴.gif","bili_tv_gif_鄙视":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/鄙视.gif","bili_tv_gif_白眼":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/白眼.gif","bili_tv_gif_doge":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/bili_tv_gif/doge.gif","menhera-chan_SR_14":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_14.jpg","menhera-chan_SR_22":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_22.jpg","menhera-chan_SR_23":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_23.jpg","menhera-chan_SR_102":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_102.jpg","menhera-chan_SR_101":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_101.jpg","menhera-chan_SR_8":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_8.jpg","menhera-chan_SR_61":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_61.jpg","menhera-chan_SR_86":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_86.jpg","menhera-chan_SR_45":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_45.jpg","menhera-chan_SR_34":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_34.jpg","menhera-chan_SR_77":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_77.jpg","menhera-chan_SR_79":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_79.jpg","menhera-chan_SR_21":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_21.jpg","menhera-chan_SR_18":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_18.jpg","menhera-chan_SR_41":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_41.jpg","menhera-chan_SR_65":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_65.jpg","menhera-chan_SR_64":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_64.jpg","menhera-chan_SR_63":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_63.jpg","menhera-chan_SR_62":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_62.jpg","menhera-chan_SR_60":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_60.jpg","menhera-chan_SR_59":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_59.jpg","menhera-chan_SR_58":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_58.jpg","menhera-chan_SR_57":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_57.jpg","menhera-chan_SR_56":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_56.jpg","menhera-chan_SR_55":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_55.jpg","menhera-chan_SR_54":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_54.jpg","menhera-chan_SR_53":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_53.jpg","menhera-chan_SR_53(1)":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_53(1).jpg","menhera-chan_SR_52":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_52.jpg","menhera-chan_SR_51":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_51.jpg","menhera-chan_SR_50":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_50.jpg","menhera-chan_SR_49":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_49.jpg","menhera-chan_SR_48":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_48.jpg","menhera-chan_SR_47":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_47.jpg","menhera-chan_SR_46":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_46.jpg","menhera-chan_SR_44":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_44.jpg","menhera-chan_SR_43":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_43.jpg","menhera-chan_SR_42":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_42.jpg","menhera-chan_SR_40":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_40.jpg","menhera-chan_SR_39":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_39.jpg","menhera-chan_SR_38":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_38.jpg","menhera-chan_SR_37":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_37.jpg","menhera-chan_SR_36":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_36.jpg","menhera-chan_SR_35":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_35.jpg","menhera-chan_SR_33":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_33.jpg","menhera-chan_SR_32":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_32.jpg","menhera-chan_SR_31":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_31.jpg","menhera-chan_SR_30":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_30.jpg","menhera-chan_SR_29":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_29.jpg","menhera-chan_SR_28":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_28.jpg","menhera-chan_SR_27":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_27.jpg","menhera-chan_SR_26":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_26.jpg","menhera-chan_SR_25":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_25.jpg","menhera-chan_SR_24":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_24.jpg","menhera-chan_SR_20":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_20.jpg","menhera-chan_SR_19":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_19.jpg","menhera-chan_SR_17":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_17.jpg","menhera-chan_SR_16":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_16.jpg","menhera-chan_SR_15":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_15.jpg","menhera-chan_SR_13":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_13.jpg","menhera-chan_SR_12":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_12.jpg","menhera-chan_SR_11":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_11.jpg","menhera-chan_SR_10":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_10.jpg","menhera-chan_SR_9":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_9.jpg","menhera-chan_SR_7":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_7.jpg","menhera-chan_SR_6":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_6.jpg","menhera-chan_SR_5":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_5.jpg","menhera-chan_SR_4":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_4.jpg","menhera-chan_SR_3":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_3.jpg","menhera-chan_SR_2":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_2.jpg","menhera-chan_SR_1":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_1.jpg","menhera-chan_SR_120":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_120.jpg","menhera-chan_SR_119":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_119.jpg","menhera-chan_SR_118":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_118.jpg","menhera-chan_SR_117":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_117.jpg","menhera-chan_SR_116":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_116.jpg","menhera-chan_SR_115":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_115.jpg","menhera-chan_SR_114":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_114.jpg","menhera-chan_SR_113":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_113.jpg","menhera-chan_SR_112":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_112.jpg","menhera-chan_SR_111":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_111.jpg","menhera-chan_SR_110":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_110.jpg","menhera-chan_SR_109":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_109.jpg","menhera-chan_SR_108":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_108.jpg","menhera-chan_SR_107":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_107.jpg","menhera-chan_SR_106":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_106.jpg","menhera-chan_SR_105":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_105.jpg","menhera-chan_SR_104":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_104.jpg","menhera-chan_SR_103":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_103.jpg","menhera-chan_SR_100":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_100.jpg","menhera-chan_SR_99":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_99.jpg","menhera-chan_SR_98":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_98.jpg","menhera-chan_SR_97":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_97.jpg","menhera-chan_SR_96":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_96.jpg","menhera-chan_SR_95":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_95.jpg","menhera-chan_SR_94":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_94.jpg","menhera-chan_SR_93":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_93.jpg","menhera-chan_SR_92":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_92.jpg","menhera-chan_SR_91":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_91.jpg","menhera-chan_SR_90":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_90.jpg","menhera-chan_SR_89":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_89.jpg","menhera-chan_SR_88":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_88.jpg","menhera-chan_SR_87":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_87.jpg","menhera-chan_SR_85":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_85.jpg","menhera-chan_SR_84":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_84.jpg","menhera-chan_SR_83":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_83.jpg","menhera-chan_SR_82":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_82.jpg","menhera-chan_SR_81":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_81.jpg","menhera-chan_SR_80":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_80.jpg","menhera-chan_SR_78":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_78.jpg","menhera-chan_SR_76":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_76.jpg","menhera-chan_SR_75":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_75.jpg","menhera-chan_SR_74":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_74.jpg","menhera-chan_SR_73":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_73.jpg","menhera-chan_SR_72":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_72.jpg","menhera-chan_SR_71":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_71.jpg","menhera-chan_SR_70":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_70.jpg","menhera-chan_SR_69":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_69.jpg","menhera-chan_SR_68":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_68.jpg","menhera-chan_SR_67":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_67.jpg","menhera-chan_SR_66":"https://fastly.jsdelivr.net/gh/tzy13755126023/emotion/menhera-chan/SR_66.jpg"},
      path: window.location.pathname,
      visitor: true
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Twikoo' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo-mjza-ih4k7fwdq-xiaozes-projects-7ca5bf96.vercel.app/',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "visitor@xiaoze.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script async src="https://at.alicdn.com/t/c/font_4822262_ld966293kg.js?spm=a313x.manage_type_myprojects.i1.10.3a093a81C6QyPB&amp;file=font_4822262_ld966293kg.js"></script><script defer type="text/javascript" src="https://cdn1.tianli0.top/npm/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script async data-pjax src="/js/lunar.js"></script><script defer data-pjax src="/js/cat.js"></script><script async data-pjax src="/js/countdown.js"></script><script defer data-pjax src="/js/cursor.js"></script><script defer data-pjax src="/js/day.js"></script><script async data-pjax src="/js/footer-animal.js?1"></script><script async data-pjax src="/js/fps.js"></script><script async data-pjax src="/js/imgloaded.js?1"></script><script async data-pjax src="/js/meihua.js"></script><script async data-pjax src="/js/privacy.js"></script><script async data-pjax src="/js/refresh.js"></script><script defer data-pjax src="/js/runtime.js"></script><script defer data-pjax src="/js/welcome.js"></script><script async data-pjax src="//at.alicdn.com/t/font_2264842_b004iy0kk2b.js"></script><script defer data-pjax src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="https://cdn1.tianli0.top/gh/nextapps-de/winbox/dist/winbox.bundle.min.js"></script><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="false" async="async"></script><script>(() => {
  const isChatBtn = true
  const isChatHideShow = true

  if (isChatBtn) {
    const close = () => {
      Chatra('minimizeWidget')
      Chatra('hide')
    }

    const open = () => {
      Chatra('openChat', true)
      Chatra('show')
    }

    window.ChatraSetup = {
      startHidden: true
    }
  
    window.chatBtnFn = () => {
      const isShow = document.getElementById('chatra').classList.contains('chatra--expanded')
      isShow ? close() : open()
    }
  } else if (isChatHideShow) {
    window.chatBtn = {
      hide: () => {
        Chatra('hide')
      },
      show: () => {
        Chatra('show')
      }
    }
  }

  (function(d, w, c) {
    w.ChatraID = 'GoNmYaJCDwWpmaags'
    var s = d.createElement('script')
    w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments)
    }
    s.async = true
    s.src = 'https://call.chatra.io/chatra.js'
    if (d.head) d.head.appendChild(s)
  })(document, window, 'Chatra')

})()</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu@1.1.6/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var qweather_key = 'ea0ecac492434e3d927d997e0938e907';
  var gaud_map_key = 'e2b04289e870b005374ee030148d64fd&s=rsv3';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '112.653411,27.969208';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu@1.1.6/lib/clock.min.js"></script><script async src="/js/ali_font.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '1.5s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('flink-list-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__flipInY');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('flink-list-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__animated');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('article-sort-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__slideInRight');
    arr[i].setAttribute('data-wow-duration', '1.5s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('site-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__flipInY');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('site-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__animated');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow_init.js"></script><!-- hexo injector body_end end --></body></html>